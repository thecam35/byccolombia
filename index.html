<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bins y Carding Colombia - Métodos, Bins, CC Gratis</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDKs COMPLETO -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: #0a0e17;
            color: #fff;
            min-height: 100vh;
        }
        
        /* Menú Hamburguesa Móvil */
        .mobile-menu-toggle {
            display: none;
            background: transparent;
            border: none;
            color: #00b4d8;
            font-size: 24px;
            cursor: pointer;
            padding: 10px;
            z-index: 1001;
        }
        
        .mobile-menu-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .mobile-menu-overlay.active {
            display: block;
            opacity: 1;
        }
        
        .mobile-sidebar {
            position: fixed;
            top: 0;
            left: -280px;
            width: 280px;
            height: 100%;
            background: #1a1f2e;
            z-index: 1000;
            transition: left 0.3s ease;
            overflow-y: auto;
            padding: 20px;
            border-right: 2px solid #00b4d8;
        }
        
        .mobile-sidebar.active {
            left: 0;
        }
        
        .mobile-sidebar .categories {
            margin-top: 60px;
        }
        
        .mobile-sidebar .close-menu {
            position: absolute;
            top: 15px;
            right: 15px;
            background: transparent;
            border: none;
            color: #00b4d8;
            font-size: 24px;
            cursor: pointer;
        }
        
        .mobile-user-info {
            display: none;
            padding: 20px;
            border-bottom: 1px solid #00b4d8;
            margin-bottom: 20px;
        }
        
        .history-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .history-modal.active {
            display: flex;
            opacity: 1;
        }
        
        .history-container {
            background: #1a1f2e;
            border-radius: 12px;
            width: 95%;
            max-width: 900px;
            max-height: 90vh;
            padding: 30px;
            position: relative;
            border: 2px solid #00b4d8;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
        }
        
        .history-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #00b4d8;
        }
        
        .history-header h2 {
            color: #00b4d8;
            font-size: 28px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        .history-header p {
            color: #90e0ef;
            font-size: 15px;
        }
        
        .history-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 1px solid #00b4d8;
            padding-bottom: 10px;
        }
        
        .history-tab {
            padding: 10px 20px;
            background: rgba(0, 180, 216, 0.1);
            border: 1px solid #00b4d8;
            border-radius: 6px;
            color: #90e0ef;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .history-tab:hover {
            background: rgba(0, 180, 216, 0.2);
        }
        
        .history-tab.active {
            background: #00b4d8;
            color: white;
        }
        
        .history-content {
            display: none;
        }
        
        .history-content.active {
            display: block;
        }
        
        .history-empty {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .history-empty i {
            font-size: 50px;
            margin-bottom: 15px;
            color: #00b4d8;
        }
        
        .history-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid rgba(0, 180, 216, 0.2);
            transition: all 0.3s;
        }
        
        .history-item:hover {
            border-color: #00b4d8;
            background: rgba(0, 180, 216, 0.05);
        }
        
        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 180, 216, 0.1);
        }
        
        .history-title {
            font-size: 18px;
            font-weight: 600;
            color: #00b4d8;
        }
        
        .history-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .status-pending {
            background: rgba(243, 156, 18, 0.2);
            color: #f39c12;
            border: 1px solid #f39c12;
        }
        
        .status-approved {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
            border: 1px solid #2ecc71;
        }
        
        .status-rejected {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid #e74c3c;
        }
        
        .status-completed {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
            border: 1px solid #3498db;
        }
        
        .history-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .history-detail {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .detail-label {
            font-size: 12px;
            color: #90e0ef;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .detail-value {
            font-size: 14px;
            color: white;
            font-weight: 500;
        }
        
        .history-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(0, 180, 216, 0.1);
        }
        
        .history-btn {
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .history-btn.view {
            background: rgba(0, 180, 216, 0.1);
            color: #00b4d8;
            border: 1px solid #00b4d8;
        }
        
        .history-btn.view:hover {
            background: rgba(0, 180, 216, 0.2);
        }
        
        .history-btn.verify {
            background: rgba(46, 204, 113, 0.1);
            color: #2ecc71;
            border: 1px solid #2ecc71;
        }
        
        .history-btn.verify:hover {
            background: rgba(46, 204, 113, 0.2);
        }
        
        .timer-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid #2ecc71;
        }
        
        .timer-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            color: #2ecc71;
            font-weight: 600;
        }
        
        .timer-display {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            color: #2ecc71;
            font-family: 'Courier New', monospace;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 6px;
            margin-bottom: 10px;
        }
        
        .timer-warning {
            color: #f39c12;
            font-size: 14px;
            text-align: center;
            margin-top: 5px;
        }
        
        .timer-expired {
            color: #e74c3c;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .auth-modal.active {
            display: flex;
            opacity: 1;
        }
        
        .auth-container {
            background: #1a1f2e;
            border-radius: 12px;
            width: 90%;
            max-width: 450px;
            padding: 40px 35px;
            position: relative;
            border: 2px solid #00b4d8;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .auth-header h2 {
            color: #00b4d8;
            font-size: 28px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        .auth-header p {
            color: #90e0ef;
            font-size: 15px;
        }
        
        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .auth-input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .auth-label {
            color: #90e0ef;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .auth-input {
            padding: 14px;
            background: #0a0e17;
            border: 1px solid #00b4d8;
            border-radius: 8px;
            font-size: 16px;
            color: white;
            outline: none;
            transition: all 0.3s;
        }
        
        .auth-input:focus {
            border-color: #00b4d8;
            box-shadow: 0 0 0 3px rgba(0, 180, 216, 0.2);
        }
        
        .auth-btn {
            padding: 14px;
            background: #00b4d8;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .auth-btn:hover {
            background: #0077b6;
            transform: translateY(-2px);
        }
        
        .auth-switch {
            text-align: center;
            margin-top: 25px;
            color: #90e0ef;
            font-size: 14px;
        }
        
        .auth-switch a {
            color: #00b4d8;
            text-decoration: none;
            font-weight: 600;
            margin-left: 5px;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .auth-switch a:hover {
            color: #90e0ef;
            text-decoration: underline;
        }
        
        .close-auth {
            position: absolute;
            top: 15px;
            right: 15px;
            background: transparent;
            border: none;
            color: #90e0ef;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-auth:hover {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            transform: rotate(90deg);
        }
        
        .captcha-container {
            background: #0a0e17;
            border: 1px solid #00b4d8;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            margin: 15px 0;
        }
        
        .captcha-code {
            font-family: 'Courier New', monospace;
            font-size: 28px;
            font-weight: bold;
            letter-spacing: 8px;
            padding: 15px;
            background: #1a1f2e;
            color: #FFFFFF !important;
            border-radius: 6px;
            margin-bottom: 15px;
            user-select: none;
            text-decoration: line-through;
            background-image: 
                linear-gradient(45deg, transparent 45%, rgba(255, 255, 255, 0.3) 45%, rgba(255, 255, 255, 0.3) 55%, transparent 55%),
                linear-gradient(-45deg, transparent 45%, rgba(255, 255, 255, 0.3) 45%, rgba(255, 255, 255, 0.3) 55%, transparent 55%);
            background-size: 20px 20px;
            position: relative;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .captcha-code::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.05) 2px, transparent 3px),
                radial-gradient(circle at 70% 60%, rgba(255, 255, 255, 0.05) 2px, transparent 3px),
                radial-gradient(circle at 40% 80%, rgba(255, 255,255, 0.05) 2px, transparent 3px),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.05) 2px, transparent 3px),
                radial-gradient(circle at 30% 50%, rgba(255, 255, 255, 0.05) 2px, transparent 3px);
            background-size: 100% 100%;
            pointer-events: none;
        }
        
        .captcha-input-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .captcha-input {
            flex: 1;
            padding: 12px;
            background: #0a0e17;
            border: 1px solid #00b4d8;
            border-radius: 6px;
            color: white;
            font-size: 16px;
            text-align: center;
            letter-spacing: 3px;
            text-transform: uppercase;
            font-weight: bold;
        }
        
        .captcha-input:focus {
            border-color: #00b4d8;
            box-shadow: 0 0 0 2px rgba(0, 180, 216, 0.2);
        }
        
        .refresh-captcha {
            background: #00b4d8;
            border: none;
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .refresh-captcha:hover {
            background: #0077b6;
            transform: rotate(180deg);
        }
        
        .auth-error {
            color: #ff6b6b;
            font-size: 14px;
            text-align: center;
            margin-top: 10px;
            padding: 8px;
            background: rgba(255, 107, 107, 0.1);
            border-radius: 6px;
            border: 1px solid #ff6b6b;
            display: none;
        }
        
        .auth-success {
            color: #2ecc71;
            font-size: 14px;
            text-align: center;
            margin-top: 10px;
            padding: 8px;
            background: rgba(46, 204, 113, 0.1);
            border-radius: 6px;
            border: 1px solid #2ecc71;
            display: none;
        }
        
        .header {
            background: #1a1f2e;
            padding: 15px 30px;
            border-bottom: 2px solid #00b4d8;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: #00b4d8;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }
        
        .logo-text {
            font-size: 24px;
            font-weight: bold;
            color: #00b4d8;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: #00b4d8;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            border: 2px solid #90e0ef;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .user-avatar:hover {
            transform: scale(1.05);
        }
        
        .auth-buttons {
            display: flex;
            gap: 15px;
        }
        
        .auth-btn-header {
            padding: 8px 20px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .login-btn {
            background: transparent;
            color: #00b4d8;
            border: 1px solid #00b4d8;
        }
        
        .login-btn:hover {
            background: rgba(0, 180, 216, 0.1);
        }
        
        .register-btn {
            background: #00b4d8;
            color: white;
            border: none;
        }
        
        .register-btn:hover {
            background: #0077b6;
            transform: translateY(-2px);
        }
        
        .history-btn-header {
            padding: 8px 20px;
            background: rgba(46, 204, 113, 0.1);
            color: #2ecc71;
            border: 1px solid #2ecc71;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .history-btn-header:hover {
            background: rgba(46, 204, 113, 0.2);
            transform: translateY(-2px);
        }
        
        .create-post-toggle-container {
            display: flex;
            justify-content: center;
            margin: 20px auto;
            width: 100%;
            max-width: 1200px;
            padding: 0 20px;
        }
        
        .create-post-toggle {
            background: #00b4d8;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }
        
        .create-post-toggle:hover {
            background: #0077b6;
            transform: translateY(-2px);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 25px;
        }
        
        .sidebar {
            background: #1a1f2e;
            border-radius: 8px;
            padding: 20px;
            height: fit-content;
            position: sticky;
            top: 100px;
        }
        
        .categories h3 {
            font-size: 18px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #00b4d8;
            color: #00b4d8;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .category {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .category:hover {
            background: rgba(0, 180, 216, 0.1);
        }
        
        .category.active {
            background: rgba(0, 180, 216, 0.15);
            color: #90e0ef;
        }
        
        .category i {
            margin-right: 12px;
            width: 20px;
            color: #00b4d8;
        }
        
        .category-premium {
            color: #ffd700;
            border-left: 3px solid #ffd700;
        }
        
        .category-premium i {
            color: #ffd700;
        }
        
        .category-count {
            margin-left: auto;
            background: rgba(0, 180, 216, 0.2);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            color: #90e0ef;
            min-width: 30px;
            text-align: center;
        }
        
        .premium-count {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .create-post-form {
            background: #1a1f2e;
            border-radius: 8px;
            padding: 0;
            border: 1px solid #00b4d8;
            max-height: 0;
            overflow: hidden;
            transition: all 0.5s ease;
            opacity: 0;
        }
        
        .create-post-form.expanded {
            padding: 25px;
            max-height: 1000px;
            opacity: 1;
            margin-bottom: 20px;
        }
        
        .create-post-form h3 {
            font-size: 20px;
            margin-bottom: 20px;
            color: #00b4d8;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .post-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .form-label {
            font-size: 14px;
            color: #90e0ef;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-input, .form-textarea, .form-select {
            padding: 12px;
            background: #0a0e17;
            border: 1px solid #00b4d8;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s;
            outline: none;
            color: white;
        }
        
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            border-color: #00b4d8;
            box-shadow: 0 0 0 2px rgba(0, 180, 216, 0.2);
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-select option {
            background: #1a1a2e;
            color: white;
        }
        
        .photo-upload-area-base64 {
            border: 2px dashed #00b4d8;
            border-radius: 6px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(0, 180, 216, 0.05);
            min-height: 150px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .photo-upload-area-base64:hover {
            border-color: #00b4d8;
            background: rgba(0, 180, 216, 0.1);
        }
        
        .upload-icon {
            font-size: 35px;
            color: #00b4d8;
            margin-bottom: 10px;
            opacity: 0.7;
        }
        
        .photo-preview-base64 {
            max-width: 100%;
            max-height: 250px;
            border-radius: 6px;
            margin-top: 10px;
            display: none;
            border: 1px solid #00b4d8;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 10px;
            position: relative;
            z-index: 10;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            z-index: 10;
        }
        
        .btn-primary {
            background: #00b4d8;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0077b6;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #2a2f3e;
            color: #90e0ef;
            border: 1px solid #00b4d8;
        }
        
        .btn-secondary:hover {
            background: rgba(0, 180, 216, 0.1);
        }
        
        .btn-premium {
            background: linear-gradient(45deg, #ffd700, #ffaa00);
            color: #000;
            font-weight: bold;
        }
        
        .btn-premium:hover {
            background: linear-gradient(45deg, #ffaa00, #ffd700);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }
        
        .posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }
        
        .post-card {
            background: #1a1f2e;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s;
            border: 1px solid #00b4d8;
            position: relative;
        }
        
        .post-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .post-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-bottom: 1px solid #00b4d8;
            background: #0a0e17;
        }
        
        .post-content {
            padding: 20px;
        }
        
        .post-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #00b4d8;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            margin-right: 12px;
            font-size: 16px;
            border: 2px solid #90e0ef;
        }
        
        .post-info {
            flex: 1;
        }
        
        .post-author {
            font-weight: 600;
            font-size: 15px;
            color: #90e0ef;
        }
        
        .post-meta {
            font-size: 13px;
            color: #aaa;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .post-category {
            background: rgba(0, 180, 216, 0.2);
            color: #00b4d8;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .post-category-premium {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
        }
        
        .post-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 10px;
            color: white;
            line-height: 1.4;
        }
        
        .post-description {
            color: #ccc;
            line-height: 1.6;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .post-code {
            background: #0a0e17;
            border: 1px solid #00b4d8;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #90e0ef;
            overflow-x: auto;
        }
        
        .post-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid #00b4d8;
            font-size: 14px;
            color: #aaa;
        }
        
        .post-actions {
            display: flex;
            gap: 15px;
        }
        
        .post-action {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: color 0.3s;
            padding: 5px 10px;
            border-radius: 6px;
        }
        
        .post-action:hover {
            background: rgba(0, 180, 216, 0.1);
            color: #00b4d8;
        }
        
        .post-action.active {
            color: #ff6b6b;
        }
        
        .view-btn {
            padding: 8px 15px;
            background: rgba(0, 180, 216, 0.1);
            color: #00b4d8;
            border-radius: 6px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid #00b4d8;
        }
        
        .view-btn:hover {
            background: rgba(0, 180, 216, 0.2);
        }
        
        .comments-preview {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #00b4d8;
        }
        
        .comment-preview {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }
        
        .comment-preview:last-child {
            margin-bottom: 0;
        }
        
        .comment-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            margin-right: 10px;
            font-size: 12px;
            flex-shrink: 0;
        }
        
        .comment-content {
            flex: 1;
        }
        
        .comment-author {
            font-weight: 600;
            font-size: 13px;
            color: #00b4d8;
            margin-bottom: 3px;
        }
        
        .comment-text {
            font-size: 13px;
            color: #ddd;
            line-height: 1.4;
        }
        
        .view-comments-btn {
            width: 100%;
            padding: 10px;
            background: rgba(0, 180, 216, 0.1);
            border: none;
            border-radius: 6px;
            color: #00b4d8;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .view-comments-btn:hover {
            background: rgba(0, 180, 216, 0.2);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .modal.active {
            display: flex;
            opacity: 1;
        }
        
        .modal-content {
            background: #1a1f2e;
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid #00b4d8;
            animation: modal-appear 0.4s;
        }
        
        @keyframes modal-appear {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.7);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: all 0.3s;
        }
        
        .close-modal:hover {
            background: #ff6b6b;
            transform: rotate(90deg);
        }
        
        .modal-image {
            width: 100%;
            max-height: 350px;
            object-fit: cover;
            border-radius: 8px 8px 0 0;
            background: #0a0e17;
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .modal-title {
            font-size: 24px;
            margin-bottom: 15px;
            color: white;
            line-height: 1.3;
        }
        
        .modal-description {
            font-size: 16px;
            line-height: 1.6;
            color: #ccc;
            margin-bottom: 20px;
        }
        
        .modal-code {
            background: #0a0e17;
            border: 1px solid #00b4d8;
            border-radius: 6px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #90e0ef;
            overflow-x: auto;
        }
        
        .modal-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 20px;
            border-top: 1px solid #00b4d8;
            margin-bottom: 30px;
        }
        
        .comments-section {
            margin-top: 30px;
        }
        
        .comments-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #00b4d8;
        }
        
        .comments-title {
            font-size: 20px;
            color: #00b4d8;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .comments-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .comment {
            display: flex;
            align-items: flex-start;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            border: 1px solid rgba(0, 180, 216, 0.1);
        }
        
        .comment-avatar-modal {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: #00b4d8;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            margin-right: 15px;
            font-size: 14px;
            flex-shrink: 0;
        }
        
        .comment-body {
            flex: 1;
        }
        
        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .comment-author-modal {
            font-weight: 600;
            color: #00b4d8;
            font-size: 14px;
        }
        
        .comment-time {
            font-size: 12px;
            color: #aaa;
        }
        
        .comment-text-modal {
            font-size: 14px;
            color: #ddd;
            line-height: 1.5;
        }
        
        .add-comment {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #00b4d8;
        }
        
        .comment-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .comment-input {
            padding: 15px;
            background: #0a0e17;
            border: 1px solid #00b4d8;
            border-radius: 6px;
            font-size: 16px;
            color: white;
            min-height: 80px;
            resize: vertical;
            outline: none;
            transition: all 0.3s;
        }
        
        .comment-input:focus {
            border-color: #00b4d8;
            box-shadow: 0 0 0 2px rgba(0, 180, 216, 0.2);
        }
        
        .comment-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        .footer {
            background: #1a1f2e;
            padding: 30px 20px;
            margin-top: 50px;
            border-top: 1px solid #00b4d8;
            text-align: center;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            color: #90e0ef;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .footer-link {
            color: #90e0ef;
            text-decoration: none;
            transition: color 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .footer-link:hover {
            color: #00b4d8;
        }
        
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: static;
                order: 2;
            }
            
            .posts-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .posts-grid {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                padding: 15px;
            }
            
            .logo-text {
                font-size: 20px;
            }
            
            .mobile-menu-toggle {
                display: block;
            }
            
            .mobile-user-info {
                display: block;
            }
            
            .desktop-user-info {
                display: none;
            }
            
            .form-actions {
                flex-direction: column;
                position: relative;
                z-index: 10;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
                position: relative;
                z-index: 10;
            }
            
            .comment-actions {
                flex-direction: column;
            }
            
            .auth-buttons {
                margin-top: 10px;
            }
            
            .captcha-code {
                font-size: 24px;
                letter-spacing: 6px;
                padding: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .header {
                padding: 10px 15px;
            }
            
            .logo-text {
                font-size: 18px;
            }
            
            .auth-btn-header {
                padding: 6px 12px;
                font-size: 13px;
            }
            
            .container {
                padding: 0 15px;
            }
        }
        
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            background: #1a1f2e;
            border-radius: 8px;
            border: 2px dashed #00b4d8;
            grid-column: 1 / -1;
        }
        
        .empty-icon {
            font-size: 60px;
            color: #00b4d8;
            margin-bottom: 20px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 3000;
            animation: slideIn 0.3s;
            max-width: 350px;
            border: 1px solid;
        }
        
        .notification.success {
            background: #2ecc71;
            border-color: #27ae60;
        }
        
        .notification.error {
            background: #e74c3c;
            border-color: #c0392b;
        }
        
        .notification.info {
            background: #3498db;
            border-color: #2980b9;
        }
        
        .notification.warning {
            background: #f39c12;
            border-color: #d68910;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .stats-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #00b4d8;
        }
        
        .stats-section h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #90e0ef;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .stat-value {
            font-weight: 600;
            color: #00b4d8;
        }
        
        .premium-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #ffd700;
            color: #000;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
            z-index: 2;
        }
        
        .premium-restricted {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            text-align: center;
            z-index: 1;
            border-radius: 8px;
        }
        
        .premium-restricted-icon {
            font-size: 50px;
            color: #ffd700;
            margin-bottom: 20px;
        }
        
        .premium-restricted h3 {
            color: #ffd700;
            font-size: 22px;
            margin-bottom: 15px;
        }
        
        .premium-restricted p {
            color: #fff;
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 20px;
            max-width: 400px;
        }
        
        .payment-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .payment-modal.active {
            display: flex;
            opacity: 1;
        }
        
        .payment-container {
            background: #1a1f2e;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            padding: 40px 35px;
            position: relative;
            border: 2px solid #ffd700;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .payment-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .payment-header h2 {
            color: #ffd700;
            font-size: 28px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        .payment-info {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid #ffd700;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .payment-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
        }
        
        .payment-detail:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .payment-label {
            color: #ffd700;
            font-weight: 600;
        }
        
        .payment-value {
            color: white;
            font-weight: 600;
        }
        
        .binance-address {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #00b4d8;
            border-radius: 6px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            text-align: center;
            color: white;
            word-break: break-all;
            margin: 15px 0;
        }
        
        .receipt-upload-area {
            border: 2px dashed #ffd700;
            border-radius: 6px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(255, 215, 0, 0.05);
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .receipt-upload-area:hover {
            border-color: #ffaa00;
            background: rgba(255, 215, 0, 0.1);
        }
        
        .receipt-upload-icon {
            font-size: 30px;
            color: #ffd700;
            margin-bottom: 10px;
            opacity: 0.7;
        }
        
        .receipt-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 6px;
            margin-top: 10px;
            display: none;
            border: 1px solid #ffd700;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .receipt-preview:hover {
            transform: scale(1.02);
        }
        
        .receipt-info {
            font-size: 12px;
            color: #90e0ef;
            margin-top: 5px;
            text-align: center;
        }
        
        .receipt-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }
        
        .confirmation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 4000;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .confirmation-modal.active {
            display: flex;
            opacity: 1;
        }
        
        .confirmation-container {
            background: #1a1f2e;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            padding: 30px;
            position: relative;
            border: 2px solid #2ecc71;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .confirmation-icon {
            text-align: center;
            font-size: 50px;
            color: #2ecc71;
            margin-bottom: 20px;
        }
        
        .admin-panel-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #ffd700;
            color: #000;
            border: none;
            border-radius: 50px;
            padding: 12px 25px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 999;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
            transition: all 0.3s;
        }
        
        .admin-panel-btn:hover {
            background: #ffaa00;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
        }
        
        .attach-receipt-btn {
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            margin-top: 15px;
        }
        
        .attach-receipt-btn:hover {
            background: #27ae60;
            transform: translateY(-2px);
        }
        
        .attach-receipt-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1a1f2e;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #00b4d8;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #0077b6;
        }
        
        .loading-spinner {
            text-align: center;
            padding: 30px;
            color: #00b4d8;
        }
        
        .loading-spinner i {
            font-size: 40px;
            margin-bottom: 15px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn:disabled:hover {
            transform: none;
            background: #00b4d8;
        }
        
        .compression-info {
            font-size: 12px;
            color: #90e0ef;
            margin-top: 5px;
            text-align: center;
        }
        
        .image-size-warning {
            color: #90e0ef;
            font-size: 12px;
            text-align: center;
            margin-top: 5px;
            display: none;
        }
        
        .image-size-warning.warning {
            color: #ffd700;
            font-weight: bold;
        }
        
        .image-size-warning.error {
            color: #ff6b6b;
            font-weight: bold;
        }
        
        #submit-btn {
            position: relative !important;
            visibility: visible !important;
            opacity: 1 !important;
            display: flex !important;
        }
        
        .file-size-info {
            font-size: 12px;
            color: #90e0ef;
            margin-top: 5px;
            text-align: center;
        }
        
        .file-size-warning {
            color: #ffd700;
            font-weight: bold;
        }
        
        .file-size-error {
            color: #ff6b6b;
            font-weight: bold;
        }
        
        .access-granted-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: #2ecc71;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
            z-index: 2;
        }
        
        .payment-info-details {
            background: rgba(0, 180, 216, 0.1);
            border: 1px solid #00b4d8;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .payment-method-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 180, 216, 0.2);
        }
        
        .payment-method-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
    </style>
</head>
<body>
    <!-- Menú Hamburguesa Móvil -->
    <div class="mobile-menu-overlay" id="mobile-menu-overlay" onclick="closeMobileMenu()"></div>
    
    <div class="mobile-sidebar" id="mobile-sidebar">
        <button class="close-menu" onclick="closeMobileMenu()">×</button>
        
        <div class="mobile-user-info" id="mobile-user-info">
            <!-- Aquí se mostrará la información del usuario en móviles -->
        </div>
        
        <div class="categories">
            <h3><i class="fas fa-folder"></i> Categorías</h3>
            <div class="category active" onclick="filterByCategory('all'); closeMobileMenu();">
                <i class="fas fa-globe"></i>
                <span>Todas las publicaciones</span>
                <span class="category-count" id="mobile-count-all">0</span>
            </div>
            <div class="category" onclick="filterByCategory('metodos'); closeMobileMenu();">
                <i class="fas fa-code"></i>
                <span>Métodos</span>
                <span class="category-count" id="mobile-count-metodos">0</span>
            </div>
            <div class="category" onclick="filterByCategory('bins'); closeMobileMenu();">
                <i class="fas fa-credit-card"></i>
                <span>Bins</span>
                <span class="category-count" id="mobile-count-bins">0</span>
            </div>
            <div class="category" onclick="filterByCategory('cc'); closeMobileMenu();">
                <i class="fas fa-money-bill-wave"></i>
                <span>CC Gratis</span>
                <span class="category-count" id="mobile-count-cc">0</span>
            </div>
            <div class="category" onclick="filterByCategory('tools'); closeMobileMenu();">
                <i class="fas fa-tools"></i>
                <span>Herramientas</span>
                <span class="category-count" id="mobile-count-tools">0</span>
            </div>
            <div class="category category-premium" onclick="filterByCategory('premium'); closeMobileMenu();">
                <i class="fas fa-crown"></i>
                <span>Premium</span>
                <span class="category-count premium-count" id="mobile-count-premium">0</span>
            </div>
            <div class="category" onclick="filterByCategory('otros'); closeMobileMenu();">
                <i class="fas fa-ellipsis-h"></i>
                <span>Otros</span>
                <span class="category-count" id="mobile-count-otros">0</span>
            </div>
        </div>
        
        <div class="stats-section">
            <h3><i class="fas fa-chart-line"></i> Estadísticas</h3>
            <div class="stat-item">
                <span>Publicaciones:</span>
                <span class="stat-value" id="mobile-total-posts">0</span>
            </div>
            <div class="stat-item">
                <span>Comentarios:</span>
                <span class="stat-value" id="mobile-total-comments">0</span>
            </div>
            <div class="stat-item">
                <span>Miembros:</span>
                <span class="stat-value" id="mobile-total-members">0</span>
            </div>
        </div>
    </div>
    
    <div class="history-modal" id="history-modal">
        <div class="history-container">
            <button class="close-auth" onclick="closeHistoryModal()">×</button>
            <div class="history-header">
                <h2><i class="fas fa-history"></i> Historial de Compras</h2>
                <p>Revisa todas tus transacciones y contenido adquirido</p>
            </div>
            
            <div class="history-tabs">
                <div class="history-tab active" onclick="switchHistoryTab('purchases')">
                    <i class="fas fa-shopping-cart"></i> Mis Compras
                </div>
                <div class="history-tab" onclick="switchHistoryTab('sales')">
                    <i class="fas fa-dollar-sign"></i> Mis Ventas
                </div>
                <div class="history-tab" onclick="switchHistoryTab('active')">
                    <i class="fas fa-clock"></i> En Verificación
                </div>
            </div>
            
            <div class="history-content active" id="purchases-content">
                <div class="loading-spinner" id="loading-purchases">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Cargando tus compras...</p>
                </div>
            </div>
            
            <div class="history-content" id="sales-content">
                <div class="loading-spinner" id="loading-sales">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Cargando tus ventas...</p>
                </div>
            </div>
            
            <div class="history-content" id="active-content">
                <div class="loading-spinner" id="loading-active">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Cargando verificaciones activas...</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="auth-modal" id="register-modal">
        <div class="auth-container">
            <button class="close-auth" onclick="closeAuthModal()">×</button>
            <div class="auth-header">
                <h2><i class="fas fa-user-plus"></i> Crear Cuenta</h2>
                <p>Únete a nuestra comunidad privada</p>
            </div>
            
            <form class="auth-form" id="register-form">
                <div class="auth-input-group">
                    <label class="auth-label"><i class="fas fa-user"></i> Nombre de usuario</label>
                    <input type="text" class="auth-input" id="register-username" placeholder="Ej: HackerPro123" required minlength="3" maxlength="20">
                </div>
                
                <div class="auth-input-group">
                    <label class="auth-label"><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" class="auth-input" id="register-email" placeholder="tucorreo@ejemplo.com" required>
                </div>
                
                <div class="auth-input-group">
                    <label class="auth-label"><i class="fas fa-lock"></i> Contraseña</label>
                    <input type="password" class="auth-input" id="register-password" placeholder="Mínimo 8 caracteres" required minlength="8">
                </div>
                
                <div class="auth-input-group">
                    <label class="auth-label"><i class="fas fa-lock"></i> Confirmar contraseña</label>
                    <input type="password" class="auth-input" id="register-confirm" placeholder="Repite tu contraseña" required minlength="8">
                </div>
                
                <!-- Campos agregados: Nequi o Binance -->
                <div class="auth-input-group">
                    <label class="auth-label"><i class="fas fa-wallet"></i> Nequi (opcional)</label>
                    <input type="text" class="auth-input" id="register-nequi" placeholder="Número de Nequi">
                </div>
                
                <div class="auth-input-group">
                    <label class="auth-label"><i class="fas fa-coins"></i> Binance (opcional)</label>
                    <input type="text" class="auth-input" id="register-binance" placeholder="ID o correo de Binance">
                </div>
                
                <div class="captcha-container">
                    <div class="captcha-code" id="register-captcha-code"></div>
                    <div class="captcha-input-container">
                        <input type="text" class="captcha-input" id="register-captcha-input" placeholder="Ingresa el código" maxlength="6" required>
                        <button type="button" class="refresh-captcha" onclick="generateCaptcha('register')">
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                </div>
                
                <div class="auth-error" id="register-error"></div>
                <div class="auth-success" id="register-success"></div>
                
                <button type="submit" class="auth-btn" id="register-submit">
                    <i class="fas fa-user-plus"></i> Crear Cuenta
                </button>
                
                <div class="auth-switch">
                    ¿Ya tienes una cuenta? 
                    <a onclick="switchToLogin()">Iniciar Sesión</a>
                </div>
            </form>
        </div>
    </div>
    
    <div class="auth-modal" id="login-modal">
        <div class="auth-container">
            <button class="close-auth" onclick="closeAuthModal()">×</button>
            <div class="auth-header">
                <h2><i class="fas fa-sign-in-alt"></i> Iniciar Sesión</h2>
                <p>Accede a tu cuenta privada</p>
            </div>
            
            <form class="auth-form" id="login-form">
                <div class="auth-input-group">
                    <label class="auth-label"><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" class="auth-input" id="login-email" placeholder="Tu email" required>
                </div>
                
                <div class="auth-input-group">
                    <label class="auth-label"><i class="fas fa-lock"></i> Contraseña</label>
                    <input type="password" class="auth-input" id="login-password" placeholder="Tu contraseña" required>
                </div>
                
                <div class="captcha-container">
                    <div class="captcha-code" id="login-captcha-code"></div>
                    <div class="captcha-input-container">
                        <input type="text" class="captcha-input" id="login-captcha-input" placeholder="Ingresa el código" maxlength="6" required>
                        <button type="button" class="refresh-captcha" onclick="generateCaptcha('login')">
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                </div>
                
                <div class="auth-error" id="login-error"></div>
                
                <button type="submit" class="auth-btn" id="login-submit">
                    <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                </button>
                
                <div class="auth-switch">
                    ¿No tienes cuenta? 
                    <a onclick="switchToRegister()">Regístrate aquí</a>
                </div>
            </form>
        </div>
    </div>
    
    <div class="payment-modal" id="payment-modal">
        <div class="payment-container">
            <button class="close-auth" onclick="closePaymentModal()">×</button>
            <div class="payment-header">
                <h2><i class="fas fa-crown"></i> Acceso Premium</h2>
                <p>Información de pago para obtener acceso</p>
            </div>
            
            <div class="payment-info">
                <div class="payment-detail">
                    <span class="payment-label">Publicación:</span>
                    <span class="payment-value" id="payment-post-title">Título de la publicación</span>
                </div>
                <div class="payment-detail">
                    <span class="payment-label">Precio:</span>
                    <span class="payment-value" id="payment-price">$0 USD</span>
                </div>
                <div class="payment-detail">
                    <span class="payment-label">Método de pago:</span>
                    <span class="payment-value">Binance</span>
                </div>
            </div>
            
            <!-- Información de pago del usuario agregada -->
            <div class="payment-info-details" id="user-payment-info" style="display: none;">
                <h3 style="color: #00b4d8; font-size: 16px; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-credit-card"></i> Información de pago del vendedor
                </h3>
                <div class="payment-method-item">
                    <span style="color: #90e0ef;">Nequi:</span>
                    <span style="color: white; font-weight: 600;" id="seller-nequi-info">No disponible</span>
                </div>
                <div class="payment-method-item">
                    <span style="color: #90e0ef;">Binance:</span>
                    <span style="color: white; font-weight: 600;" id="seller-binance-info">No disponible</span>
                </div>
            </div>
            
            <div>
                <p style="text-align: center; color: #90e0ef; margin-bottom: 10px;">
                    Envía el pago a la siguiente dirección de Binance:
                </p>
                <div class="binance-address" id="binance-address">
                    357239258
                </div>
                
                <div style="margin-top: 25px;">
                    <h3 style="color: #ffd700; font-size: 18px; margin-bottom: 15px; text-align: center;">
                        <i class="fas fa-file-upload"></i> Adjuntar Comprobante de Pago
                    </h3>
                    
                    <div class="receipt-upload-area" id="receipt-upload-area" onclick="document.getElementById('receipt-input').click()">
                        <div class="receipt-upload-icon">
                            <i class="fas fa-file-invoice-dollar"></i>
                        </div>
                        <p style="color: #90e0ef; margin-bottom: 5px;">Haz clic para subir tu comprobante</p>
                        <p class="receipt-info">Formatos aceptados: JPG, PNG, PDF, WEBP (Máximo 5MB)</p>
                        <p class="file-size-info" id="receipt-size-info"></p>
                        <input type="file" id="receipt-input" accept=".jpg,.jpeg,.png,.pdf,.webp" style="display: none;" onchange="previewReceiptBase64(event)">
                    </div>
                    
                    <img id="receipt-preview" class="receipt-preview" alt="Vista previa del comprobante">
                    
                    <div class="receipt-actions">
                        <button type="button" class="btn btn-secondary" onclick="clearReceipt()" style="padding: 8px 15px;">
                            <i class="fas fa-times"></i> Eliminar
                        </button>
                        <button type="button" class="attach-receipt-btn" id="submit-receipt-btn" onclick="submitPaymentReceiptBase64()" disabled>
                            <i class="fas fa-paper-plane"></i> Enviar Comprobante
                        </button>
                    </div>
                    
                    <div id="receipt-error" class="auth-error" style="margin-top: 10px;"></div>
                </div>
                
                <p style="text-align: center; color: #90e0ef; font-size: 14px; margin-top: 15px;">
                    Después de realizar el pago y subir el comprobante, un administrador revisará tu solicitud.
                </p>
            </div>
            
            <button type="button" class="auth-btn" onclick="closePaymentModal()" style="margin-top: 25px; background: #555; color: #fff;">
                <i class="fas fa-times"></i> Cancelar
            </button>
        </div>
    </div>
    
    <div class="confirmation-modal" id="confirmation-modal">
        <div class="confirmation-container">
            <button class="close-auth" onclick="closeConfirmationModal()">×</button>
            <div class="confirmation-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div style="text-align: center; margin-bottom: 25px;">
                <h2 style="color: #2ecc71; margin-bottom: 10px;">¡Comprobante Enviado!</h2>
                <p style="color: #90e0ef;">Tu comprobante de pago ha sido enviado exitosamente.</p>
                <p style="color: #90e0ef; font-size: 14px;">Un administrador revisará tu solicitud y te notificará cuando sea aprobada.</p>
            </div>
            <button type="button" class="auth-btn" onclick="closeConfirmationModal()" style="background: #2ecc71;">
                <i class="fas fa-check"></i> Aceptar
            </button>
        </div>
    </div>
    
    <header class="header">
        <div class="header-content">
            <button class="mobile-menu-toggle" id="mobile-menu-toggle" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-comments"></i>
                </div>
                <div class="logo-text">Bins Carding Colombia</div>
            </div>
            
            <div class="user-info desktop-user-info" id="user-info">
                <div class="auth-buttons" id="auth-buttons">
                    <button class="auth-btn-header login-btn" onclick="openLoginModal()">
                        <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                    </button>
                    <button class="auth-btn-header register-btn" onclick="openRegisterModal()">
                        <i class="fas fa-user-plus"></i> Registrarse
                    </button>
                </div>
            </div>
        </div>
    </header>
    
    <div class="create-post-toggle-container" id="create-post-container" style="display: none;">
        <button class="create-post-toggle" onclick="toggleCreatePost()">
            <i class="fas fa-plus-circle"></i>
            Crear Nueva Publicación
        </button>
    </div>
    
    <div class="container">
        <aside class="sidebar">
            <div class="categories">
                <h3><i class="fas fa-folder"></i> Categorías</h3>
                <div class="category active" onclick="filterByCategory('all')">
                    <i class="fas fa-globe"></i>
                    <span>Todas las publicaciones</span>
                    <span class="category-count" id="count-all">0</span>
                </div>
                <div class="category" onclick="filterByCategory('metodos')">
                    <i class="fas fa-code"></i>
                    <span>Métodos</span>
                    <span class="category-count" id="count-metodos">0</span>
                </div>
                <div class="category" onclick="filterByCategory('bins')">
                    <i class="fas fa-credit-card"></i>
                    <span>Bins</span>
                    <span class="category-count" id="count-bins">0</span>
                </div>
                <div class="category" onclick="filterByCategory('cc')">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>CC Gratis</span>
                    <span class="category-count" id="count-cc">0</span>
                </div>
                <div class="category" onclick="filterByCategory('tools')">
                    <i class="fas fa-tools"></i>
                    <span>Herramientas</span>
                    <span class="category-count" id="count-tools">0</span>
                </div>
                <div class="category category-premium" onclick="filterByCategory('premium')">
                    <i class="fas fa-crown"></i>
                    <span>Premium</span>
                    <span class="category-count premium-count" id="count-premium">0</span>
                </div>
                <div class="category" onclick="filterByCategory('otros')">
                    <i class="fas fa-ellipsis-h"></i>
                    <span>Otros</span>
                    <span class="category-count" id="count-otros">0</span>
                </div>
            </div>
            
            <div class="stats-section">
                <h3><i class="fas fa-chart-line"></i> Estadísticas</h3>
                <div class="stat-item">
                    <span>Publicaciones:</span>
                    <span class="stat-value" id="total-posts">0</span>
                </div>
                <div class="stat-item">
                    <span>Comentarios:</span>
                    <span class="stat-value" id="total-comments">0</span>
                </div>
                <div class="stat-item">
                    <span>Miembros:</span>
                    <span class="stat-value" id="total-members">0</span>
                </div>
                <div class="stat-item">
                    <span>Online:</span>
                    <span class="stat-value">0</span>
                </div>
                <div class="stat-item">
                    <span>Administradores:</span>
                    <span class="stat-value">0</span>
                </div>
            </div>
        </aside>
        
        <main class="main-content">
            <div class="create-post-form" id="create-post-form">
                <h3><i class="fas fa-plus"></i> Nueva Publicación</h3>
                <form class="post-form" id="post-form">
                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-heading"></i> Título</label>
                        <input type="text" class="form-input" id="post-title" placeholder="Título descriptivo..." maxlength="80" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-align-left"></i> Descripción</label>
                        <textarea class="form-textarea" id="post-description" placeholder="Descripción detallada..." rows="4" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-image"></i> Imagen (opcional - Máximo 5MB)</label>
                        <div class="photo-upload-area-base64" id="photo-upload-area" onclick="document.getElementById('photo-input').click()">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <p>Haz clic para subir una imagen</p>
                            <p class="compression-info">Máximo 5MB - Se comprimirá automáticamente</p>
                            <p class="image-size-warning" id="size-warning"></p>
                            <input type="file" id="photo-input" accept="image/*" style="display: none;" onchange="previewImageBase64(event)">
                        </div>
                        <img id="photo-preview" class="photo-preview-base64" alt="Vista previa">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-tag"></i> Categoría</label>
                        <select class="form-select" id="post-category" required onchange="togglePriceField()">
                            <option value="metodos">Métodos</option>
                            <option value="bins">Bins</option>
                            <option value="cc">CC Gratis</option>
                            <option value="tools">Herramientas</option>
                            <option value="premium" id="premium-option" style="display: none;">Premium</option>
                            <option value="otros">Otros</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="price-field-group" style="display: none;">
                        <label class="form-label"><i class="fas fa-dollar-sign"></i> Precio (USD)</label>
                        <input type="number" class="form-input" id="post-price" placeholder="Ej: 50" min="1" max="1000" step="0.01">
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="toggleCreatePost()">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                        <button type="button" class="btn btn-primary" onclick="createPost()" id="submit-btn">
                            <i class="fas fa-paper-plane"></i> Publicar
                        </button>
                    </div>
                </form>
            </div>
            
            <div class="posts-grid" id="posts-grid">
                <div class="loading-spinner" id="loading-posts">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Cargando publicaciones...</p>
                </div>
            </div>
        </main>
    </div>
    
    <div class="modal" id="post-modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">×</button>
            <img id="modal-image" class="modal-image" alt="Imagen de la publicación" style="display: none;">
            <div class="modal-body">
                <div class="post-header">
                    <div class="post-avatar" id="modal-avatar"></div>
                    <div class="post-info">
                        <div class="post-author" id="modal-author"></div>
                        <div class="post-meta">
                            <span class="post-category" id="modal-category"></span>
                            <span id="modal-date"></span>
                        </div>
                    </div>
                </div>
                
                <h2 id="modal-title" class="modal-title"></h2>
                <p id="modal-description" class="modal-description"></p>
                <div id="modal-code" class="modal-code" style="display: none;"></div>
                
                <!-- Información de pago del vendedor en detalle de compra -->
                <div class="payment-info-details" id="seller-payment-details" style="display: none; margin-top: 20px;">
                    <h3 style="color: #00b4d8; font-size: 16px; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-credit-card"></i> Información de pago del vendedor
                    </h3>
                    <div class="payment-method-item">
                        <span style="color: #90e0ef;">Nequi:</span>
                        <span style="color: white; font-weight: 600;" id="seller-nequi">No disponible</span>
                    </div>
                    <div class="payment-method-item">
                        <span style="color: #90e0ef;">Binance:</span>
                        <span style="color: white; font-weight: 600;" id="seller-binance">No disponible</span>
                    </div>
                </div>
                
                <div class="modal-meta">
                    <div class="post-actions">
                        <div class="post-action" id="modal-like-btn" onclick="likePostModal()">
                            <i class="far fa-heart" id="modal-like-icon"></i>
                            <span id="modal-likes">0</span>
                        </div>
                        <div class="post-action">
                            <i class="far fa-eye"></i>
                            <span id="modal-views">0</span>
                        </div>
                        <div class="post-action">
                            <i class="far fa-comment"></i>
                            <span id="modal-comments-count">0</span>
                        </div>
                    </div>
                </div>
                
                <div id="purchase-history-section" style="display: none;">
                    <div class="timer-container" id="timer-container">
                        <div class="timer-header">
                            <i class="fas fa-clock"></i>
                            <span>Tiempo de verificación</span>
                        </div>
                        <div class="timer-display" id="timer-display">
                            05:00:00
                        </div>
                        <p class="timer-warning">
                            Tienes 5 horas para verificar que el producto funciona correctamente.
                            Si encuentras algún problema, contacta al administrador.
                        </p>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: rgba(46, 204, 113, 0.1); border-radius: 6px; border: 1px solid #2ecc71;">
                        <h3 style="color: #2ecc71; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-check-circle"></i> Acceso Premium Activado
                        </h3>
                        <p style="color: #90e0ef; font-size: 14px;">
                            Tu pago ha sido aprobado. Ahora puedes acceder a todo el contenido de esta publicación.
                        </p>
                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button class="history-btn verify" onclick="verifyProduct()">
                                <i class="fas fa-check"></i> Confirmar que todo está bien
                            </button>
                            <button class="history-btn view" onclick="reportIssue()">
                                <i class="fas fa-exclamation-triangle"></i> Reportar problema
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="comments-section">
                    <div class="comments-header">
                        <h3 class="comments-title">
                            <i class="fas fa-comments"></i>
                            <span id="comments-count">Comentarios (0)</span>
                        </h3>
                    </div>
                    
                    <div class="comments-list" id="comments-list">
                    </div>
                    
                    <div class="add-comment">
                        <div class="comment-form">
                            <textarea 
                                class="comment-input" 
                                id="comment-input" 
                                placeholder="Escribe tu comentario aquí..."
                                rows="3"
                            ></textarea>
                            <div class="comment-actions">
                                <button type="button" class="btn btn-secondary" onclick="clearComment()">
                                    <i class="fas fa-times"></i> Cancelar
                                </button>
                                <button type="button" class="btn btn-primary" onclick="addComment()">
                                    <i class="fas fa-paper-plane"></i> Comentar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <p>© 2023 Foro Privado - Compartiendo conocimiento</p>
            <div class="footer-links">
                <a href="#" class="footer-link"><i class="fas fa-info-circle"></i> Acerca</a>
                <a href="#" class="footer-link"><i class="fas fa-book"></i> Tutoriales</a>
                <a href="#" class="footer-link"><i class="fas fa-question-circle"></i> FAQ</a>
                <a href="#" class="footer-link"><i class="fas fa-cog"></i> Configuración</a>
            </div>
        </div>
    </footer>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDOxA6QmXJX_z8j-LNL5gxwC9_rueidy_8",
            authDomain: "binscardingcolombia.firebaseapp.com",
            projectId: "binscardingcolombia",
            storageBucket: "binscardingcolombia.firebasestorage.app",
            messagingSenderId: "399727287776",
            appId: "1:399727287776:web:512082cbf7f5479d285f85",
            measurementId: "G-2MMHZP32C5"
        };
        
        let currentUser = null;
        let users = [];
        let posts = [];
        let currentCategory = "all";
        let selectedImageBase64 = null;
        let currentPostId = null;
        let selectedReceiptFile = null;
        let selectedReceiptBase64 = null;
        let currentPaymentPost = null;
        let purchaseHistory = [];
        let salesHistory = [];
        let activeVerifications = [];
        let verificationTimers = {};
        
        let registerCaptcha = "";
        let loginCaptcha = "";
        
        const BINANCE_ADDRESS = "357239258";
        const MAX_RECEIPT_SIZE = 5 * 1024 * 1024;
        const VERIFICATION_TIME = 5 * 60 * 60 * 1000;
        
        function initializeFirebase() {
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                console.log("Firebase inicializado correctamente");
                return true;
            } catch (error) {
                console.error("Error inicializando Firebase:", error);
                showNotification("Error al conectar con la base de datos", "error");
                return false;
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });
        
        async function initializeApp() {
            try {
                if (!initializeFirebase()) {
                    throw new Error("No se pudo inicializar Firebase");
                }
                
                generateCaptcha('register');
                generateCaptcha('login');
                
                document.getElementById('register-form').addEventListener('submit', function(e) {
                    e.preventDefault();
                    registerUser();
                });
                
                document.getElementById('login-form').addEventListener('submit', function(e) {
                    e.preventDefault();
                    loginUser();
                });
                
                firebase.auth().onAuthStateChanged(async (user) => {
                    if (user) {
                        await loadUserData(user);
                        await loadPurchaseHistory();
                        await loadSalesHistory();
                        await loadActiveVerifications();
                        await loadPosts();
                    } else {
                        currentUser = null;
                        purchaseHistory = [];
                        salesHistory = [];
                        activeVerifications = [];
                        updateAuthUI();
                        updateMobileUserInfo();
                    }
                });
                
                await loadPosts();
                
                document.getElementById('post-description').addEventListener('keydown', function(e) {
                    if (e.ctrlKey && e.key === 'Enter') {
                        createPost();
                    }
                });
                
                document.getElementById('comment-input').addEventListener('keydown', function(e) {
                    if (e.ctrlKey && e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        addComment();
                    }
                });
                
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape') {
                        closeAuthModal();
                        closePaymentModal();
                        closeConfirmationModal();
                        closeHistoryModal();
                        closeMobileMenu();
                    }
                });
                
                setInterval(checkVerificationTimers, 60000);
                
                startPaymentListener();
                
            } catch (error) {
                console.error("Error inicializando la aplicación:", error);
                showNotification("Error al cargar la aplicación", "error");
            }
        }
        
        function toggleMobileMenu() {
            const overlay = document.getElementById('mobile-menu-overlay');
            const sidebar = document.getElementById('mobile-sidebar');
            
            if (overlay && sidebar) {
                overlay.classList.toggle('active');
                sidebar.classList.toggle('active');
                document.body.style.overflow = sidebar.classList.contains('active') ? 'hidden' : 'auto';
            }
        }
        
        function closeMobileMenu() {
            const overlay = document.getElementById('mobile-menu-overlay');
            const sidebar = document.getElementById('mobile-sidebar');
            
            if (overlay && sidebar) {
                overlay.classList.remove('active');
                sidebar.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }
        
        function updateMobileUserInfo() {
            const mobileUserInfo = document.getElementById('mobile-user-info');
            if (!mobileUserInfo) return;
            
            if (currentUser) {
                mobileUserInfo.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="user-avatar" onclick="showProfile()" title="${currentUser.username}">
                            ${currentUser.avatar}
                        </div>
                        <div style="display: flex; flex-direction: column;">
                            <div style="display: flex; align-items: center;">
                                <span style="font-weight: 600; color: #00b4d8;">${currentUser.username}</span>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 5px;">
                                <a href="#" onclick="logoutUser(); closeMobileMenu(); return false;" style="font-size: 12px; color: #90e0ef; text-decoration: none;">
                                    <i class="fas fa-sign-out-alt"></i> Cerrar sesión
                                </a>
                                <a href="#" onclick="openHistoryModal(); closeMobileMenu(); return false;" style="font-size: 12px; color: #2ecc71; text-decoration: none;">
                                    <i class="fas fa-history"></i> Historial
                                </a>
                            </div>
                        </div>
                    </div>
                `;
                mobileUserInfo.style.display = 'block';
            } else {
                mobileUserInfo.innerHTML = `
                    <div style="text-align: center;">
                        <p style="margin-bottom: 15px; color: #90e0ef;">Inicia sesión para acceder a todas las funciones</p>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <button class="auth-btn-header login-btn" onclick="openLoginModal(); closeMobileMenu();" style="width: 100%;">
                                <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                            </button>
                            <button class="auth-btn-header register-btn" onclick="openRegisterModal(); closeMobileMenu();" style="width: 100%;">
                                <i class="fas fa-user-plus"></i> Registrarse
                            </button>
                        </div>
                    </div>
                `;
                mobileUserInfo.style.display = 'block';
            }
        }
        
        function updateMobileStats() {
            const counts = {
                all: posts.length,
                metodos: posts.filter(post => post.category === 'metodos').length,
                bins: posts.filter(post => post.category === 'bins').length,
                cc: posts.filter(post => post.category === 'cc').length,
                tools: posts.filter(post => post.category === 'tools').length,
                premium: posts.filter(post => post.category === 'premium').length,
                otros: posts.filter(post => post.category === 'otros').length
            };
            
            for (const category in counts) {
                const element = document.getElementById(`mobile-count-${category}`);
                if (element) {
                    element.textContent = counts[category];
                }
            }
            
            const totalComments = posts.reduce((total, post) => total + (post.comments ? post.comments.length : 0), 0);
            
            const mobileTotalPosts = document.getElementById('mobile-total-posts');
            const mobileTotalComments = document.getElementById('mobile-total-comments');
            const mobileTotalMembers = document.getElementById('mobile-total-members');
            
            if (mobileTotalPosts) mobileTotalPosts.textContent = posts.length;
            if (mobileTotalComments) mobileTotalComments.textContent = totalComments;
            if (mobileTotalMembers) mobileTotalMembers.textContent = users.length;
        }
        
        function startPaymentListener() {
            if (!currentUser) return;
            
            firebase.firestore().collection('payments')
                .where('userId', '==', currentUser.uid)
                .onSnapshot(async (snapshot) => {
                    const changes = snapshot.docChanges();
                    
                    for (const change of changes) {
                        if (change.type === 'modified') {
                            const payment = change.doc.data();
                            
                            if (payment.status === 'approved') {
                                await loadPurchaseHistory();
                                await loadPosts();
                                
                                showNotification(`¡Acceso concedido a "${payment.postTitle}"!`, 'success');
                                
                                if (currentPostId === payment.postId) {
                                    openPostModal(currentPostId);
                                }
                            }
                        }
                    }
                });
        }
        
        async function loadPurchaseHistory() {
            if (!currentUser) return;
            
            try {
                const loadingElement = document.getElementById('loading-purchases');
                if (loadingElement) loadingElement.style.display = 'block';
                
                const purchasesSnapshot = await firebase.firestore().collection('payments')
                    .where('userId', '==', currentUser.uid)
                    .where('status', '==', 'approved')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                purchaseHistory = [];
                purchasesSnapshot.forEach(doc => {
                    purchaseHistory.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                if (loadingElement) loadingElement.style.display = 'none';
                
                if (document.getElementById('history-modal').classList.contains('active')) {
                    renderPurchaseHistory();
                }
                
            } catch (error) {
                console.error("Error cargando historial de compras:", error);
                const loadingElement = document.getElementById('loading-purchases');
                if (loadingElement) loadingElement.style.display = 'none';
            }
        }
        
        async function loadSalesHistory() {
            if (!currentUser || !currentUser.isAdmin) return;
            
            try {
                const loadingElement = document.getElementById('loading-sales');
                if (loadingElement) loadingElement.style.display = 'block';
                
                const salesSnapshot = await firebase.firestore().collection('payments')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                salesHistory = [];
                
                for (const doc of salesSnapshot.docs) {
                    const payment = doc.data();
                    const postDoc = await firebase.firestore().collection('posts').doc(payment.postId).get();
                    
                    if (postDoc.exists) {
                        const post = postDoc.data();
                        if (post.authorId === currentUser.uid) {
                            salesHistory.push({
                                id: doc.id,
                                ...payment,
                                postTitle: post.title
                            });
                        }
                    }
                }
                
                if (loadingElement) loadingElement.style.display = 'none';
                
                if (document.getElementById('history-modal').classList.contains('active')) {
                    renderSalesHistory();
                }
                
            } catch (error) {
                console.error("Error cargando historial de ventas:", error);
                const loadingElement = document.getElementById('loading-sales');
                if (loadingElement) loadingElement.style.display = 'none';
            }
        }
        
        async function loadActiveVerifications() {
            if (!currentUser) return;
            
            try {
                const loadingElement = document.getElementById('loading-active');
                if (loadingElement) loadingElement.style.display = 'block';
                
                const fiveHoursAgo = new Date(Date.now() - VERIFICATION_TIME);
                
                const verificationsSnapshot = await firebase.firestore().collection('payments')
                    .where('userId', '==', currentUser.uid)
                    .where('status', '==', 'approved')
                    .where('approvedAt', '>', fiveHoursAgo.toISOString())
                    .orderBy('approvedAt', 'desc')
                    .get();
                
                activeVerifications = [];
                verificationsSnapshot.forEach(doc => {
                    const payment = doc.data();
                    activeVerifications.push({
                        id: doc.id,
                        ...payment,
                        timeLeft: calculateTimeLeft(payment.approvedAt)
                    });
                });
                
                if (loadingElement) loadingElement.style.display = 'none';
                
                if (document.getElementById('history-modal').classList.contains('active')) {
                    renderActiveVerifications();
                }
                
                startVerificationTimers();
                
            } catch (error) {
                console.error("Error cargando verificaciones activas:", error);
                const loadingElement = document.getElementById('loading-active');
                if (loadingElement) loadingElement.style.display = 'none';
            }
        }
        
        function calculateTimeLeft(approvedAt) {
            if (!approvedAt) return 0;
            
            const approvedTime = new Date(approvedAt).getTime();
            const currentTime = Date.now();
            const elapsedTime = currentTime - approvedTime;
            const timeLeft = VERIFICATION_TIME - elapsedTime;
            
            return Math.max(0, timeLeft);
        }
        
        function startVerificationTimers() {
            for (const timerId in verificationTimers) {
                clearInterval(verificationTimers[timerId]);
            }
            verificationTimers = {};
            
            activeVerifications.forEach(payment => {
                const timerId = `timer_${payment.id}`;
                
                if (payment.timeLeft > 0) {
                    verificationTimers[timerId] = setInterval(() => {
                        updateTimerDisplay(payment.id);
                    }, 1000);
                    
                    updateTimerDisplay(payment.id);
                }
            });
        }
        
        function updateTimerDisplay(paymentId) {
            const payment = activeVerifications.find(p => p.id === paymentId);
            if (!payment) return;
            
            payment.timeLeft = calculateTimeLeft(payment.approvedAt);
            
            const hours = Math.floor(payment.timeLeft / (1000 * 60 * 60));
            const minutes = Math.floor((payment.timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((payment.timeLeft % (1000 * 60)) / 1000);
            
            const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const timerElement = document.querySelector(`[data-payment-id="${paymentId}"] .timer-display`);
            if (timerElement) {
                timerElement.textContent = timeString;
                
                if (payment.timeLeft < 30 * 60 * 1000) {
                    timerElement.classList.add('timer-expired');
                }
            }
            
            if (currentPostId) {
                const postPayment = purchaseHistory.find(p => p.postId === currentPostId && p.status === 'approved');
                if (postPayment && postPayment.id === paymentId) {
                    const modalTimer = document.getElementById('timer-display');
                    if (modalTimer) {
                        modalTimer.textContent = timeString;
                        
                        if (payment.timeLeft < 30 * 60 * 1000) {
                            modalTimer.classList.add('timer-expired');
                        }
                    }
                }
            }
            
            if (payment.timeLeft <= 0) {
                clearInterval(verificationTimers[`timer_${paymentId}`]);
                delete verificationTimers[`timer_${paymentId}`];
                
                updatePaymentVerificationStatus(paymentId, 'completed');
            }
        }
        
        async function checkVerificationTimers() {
            if (!currentUser) return;
            
            try {
                await loadActiveVerifications();
            } catch (error) {
                console.error("Error verificando timers:", error);
            }
        }
        
        async function updatePaymentVerificationStatus(paymentId, status) {
            try {
                await firebase.firestore().collection('payments').doc(paymentId).update({
                    verificationStatus: status,
                    updatedAt: new Date().toISOString()
                });
                
                await loadPurchaseHistory();
                await loadActiveVerifications();
                
                showNotification(`Estado de verificación actualizado a: ${status}`, 'success');
                
            } catch (error) {
                console.error("Error actualizando estado de verificación:", error);
                showNotification('Error al actualizar estado', 'error');
            }
        }
        
        async function verifyProduct() {
            if (!currentUser || !currentPostId) return;
            
            try {
                const payment = purchaseHistory.find(p => p.postId === currentPostId && p.status === 'approved');
                if (!payment) return;
                
                await updatePaymentVerificationStatus(payment.id, 'verified');
                
                showNotification('¡Gracias por confirmar! El producto ha sido marcado como verificado.', 'success');
                
                const verificationSection = document.getElementById('purchase-history-section');
                if (verificationSection) {
                    verificationSection.style.display = 'none';
                }
                
                await notifySellerAboutVerification(payment);
                
            } catch (error) {
                console.error("Error verificando producto:", error);
                showNotification('Error al verificar producto', 'error');
            }
        }
        
        async function reportIssue() {
            if (!currentUser || !currentPostId) return;
            
            const issue = prompt("Describe el problema que encontraste con el producto:");
            if (!issue || issue.trim() === '') return;
            
            try {
                const payment = purchaseHistory.find(p => p.postId === currentPostId && p.status === 'approved');
                if (!payment) return;
                
                await firebase.firestore().collection('payments').doc(payment.id).update({
                    issueReport: issue.trim(),
                    verificationStatus: 'reported',
                    updatedAt: new Date().toISOString()
                });
                
                showNotification('Problema reportado. Un administrador revisará tu caso.', 'warning');
                
                await notifyAdminsAboutIssue(payment, issue.trim());
                
            } catch (error) {
                console.error("Error reportando problema:", error);
                showNotification('Error al reportar problema', 'error');
            }
        }
        
        async function notifySellerAboutVerification(payment) {
            try {
                const postDoc = await firebase.firestore().collection('posts').doc(payment.postId).get();
                if (!postDoc.exists) return;
                
                const post = postDoc.data();
                
                const notificationData = {
                    type: 'product_verified',
                    title: 'Producto verificado por el comprador',
                    message: `${payment.username} ha confirmado que el producto "${post.title}" está funcionando correctamente.`,
                    paymentId: payment.id,
                    userId: post.authorId,
                    read: false,
                    createdAt: new Date().toISOString()
                };
                
                await firebase.firestore().collection('notifications').add(notificationData);
                
            } catch (error) {
                console.error("Error notificando al vendedor:", error);
            }
        }
        
        async function notifyAdminsAboutIssue(payment, issue) {
            try {
                const adminsSnapshot = await firebase.firestore().collection('users')
                    .where('isAdmin', '==', true)
                    .get();
                
                const postDoc = await firebase.firestore().collection('posts').doc(payment.postId).get();
                const post = postDoc.exists ? postDoc.data() : { title: 'Producto desconocido' };
                
                adminsSnapshot.forEach(async (doc) => {
                    const adminData = doc.data();
                    
                    const notificationData = {
                        type: 'product_issue',
                        title: 'Problema reportado con producto',
                        message: `${payment.username} reportó un problema con "${post.title}": ${issue}`,
                        paymentId: payment.id,
                        userId: adminData.uid || doc.id,
                        read: false,
                        createdAt: new Date().toISOString()
                    };
                    
                    await firebase.firestore().collection('notifications').add(notificationData);
                });
                
            } catch (error) {
                console.error("Error notificando administradores:", error);
            }
        }
        
        function renderPurchaseHistory() {
            const container = document.getElementById('purchases-content');
            if (!container) return;
            
            if (purchaseHistory.length === 0) {
                container.innerHTML = `
                    <div class="history-empty">
                        <i class="fas fa-shopping-cart"></i>
                        <h3>No tienes compras realizadas</h3>
                        <p>Cuando compres contenido premium, aparecerá aquí.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            purchaseHistory.forEach(payment => {
                const paymentElement = createHistoryItem(payment, 'purchase');
                container.appendChild(paymentElement);
            });
        }
        
        function renderSalesHistory() {
            const container = document.getElementById('sales-content');
            if (!container) return;
            
            if (salesHistory.length === 0) {
                container.innerHTML = `
                    <div class="history-empty">
                        <i class="fas fa-dollar-sign"></i>
                        <h3>No tienes ventas realizadas</h3>
                        <p>Cuando alguien compre tus publicaciones premium, aparecerán aquí.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            salesHistory.forEach(payment => {
                const paymentElement = createHistoryItem(payment, 'sale');
                container.appendChild(paymentElement);
            });
        }
        
        function renderActiveVerifications() {
            const container = document.getElementById('active-content');
            if (!container) return;
            
            if (activeVerifications.length === 0) {
                container.innerHTML = `
                    <div class="history-empty">
                        <i class="fas fa-clock"></i>
                        <h3>No tienes verificaciones activas</h3>
                        <p>Cuando un administrador apruebe tu pago, tendrás 5 horas para verificar el producto.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            activeVerifications.forEach(payment => {
                const paymentElement = createHistoryItem(payment, 'verification');
                container.appendChild(paymentElement);
            });
        }
        
        function createHistoryItem(payment, type) {
            const element = document.createElement('div');
            element.className = 'history-item';
            element.dataset.paymentId = payment.id;
            
            let statusClass = '';
            let statusText = '';
            
            switch (payment.status) {
                case 'pending':
                    statusClass = 'status-pending';
                    statusText = 'PENDIENTE';
                    break;
                case 'approved':
                    statusClass = 'status-approved';
                    statusText = 'APROBADO';
                    break;
                case 'rejected':
                    statusClass = 'status-rejected';
                    statusText = 'RECHAZADO';
                    break;
                case 'completed':
                    statusClass = 'status-completed';
                    statusText = 'COMPLETADO';
                    break;
                default:
                    statusClass = 'status-pending';
                    statusText = payment.status.toUpperCase();
            }
            
            const paymentDate = formatDate(payment.createdAt);
            const approvedDate = payment.approvedAt ? formatDate(payment.approvedAt) : 'No aprobado';
            
            let timerHTML = '';
            if (type === 'verification' && payment.status === 'approved' && payment.timeLeft > 0) {
                const hours = Math.floor(payment.timeLeft / (1000 * 60 * 60));
                const minutes = Math.floor((payment.timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((payment.timeLeft % (1000 * 60)) / 1000);
                const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                timerHTML = `
                    <div class="timer-container">
                        <div class="timer-header">
                            <i class="fas fa-clock"></i>
                            <span>Tiempo restante para verificación</span>
                        </div>
                        <div class="timer-display ${payment.timeLeft < 30 * 60 * 1000 ? 'timer-expired' : ''}">
                            ${timeString}
                        </div>
                    </div>
                `;
            }
            
            let actionsHTML = '';
            
            if (type === 'purchase') {
                actionsHTML = `
                    <div class="history-actions">
                        <button class="history-btn view" onclick="viewPurchasedContent('${payment.postId}')">
                            <i class="fas fa-eye"></i> Ver Contenido
                        </button>
                        ${payment.status === 'approved' && payment.verificationStatus !== 'verified' && payment.timeLeft > 0 ? `
                            <button class="history-btn verify" onclick="openPostModal('${payment.postId}')">
                                <i class="fas fa-check"></i> Verificar Producto
                            </button>
                        ` : ''}
                    </div>
                `;
            } else if (type === 'sale') {
                actionsHTML = `
                    <div class="history-actions">
                        <button class="history-btn view" onclick="viewPurchasedContent('${payment.postId}')">
                            <i class="fas fa-eye"></i> Ver Publicación
                        </button>
                    </div>
                `;
            } else if (type === 'verification') {
                actionsHTML = `
                    <div class="history-actions">
                        <button class="history-btn view" onclick="openPostModal('${payment.postId}')">
                            <i class="fas fa-eye"></i> Verificar Ahora
                        </button>
                    </div>
                `;
            }
            
            element.innerHTML = `
                <div class="history-item-header">
                    <div class="history-title">${payment.postTitle || 'Producto Premium'}</div>
                    <div class="history-status ${statusClass}">${statusText}</div>
                </div>
                
                <div class="history-details">
                    <div class="history-detail">
                        <span class="detail-label">Monto</span>
                        <span class="detail-value">$${payment.postPrice || '0'} USD</span>
                    </div>
                    <div class="history-detail">
                        <span class="detail-label">Fecha de pago</span>
                        <span class="detail-value">${paymentDate}</span>
                    </div>
                    <div class="history-detail">
                        <span class="detail-label">Estado</span>
                        <span class="detail-value">${type === 'sale' ? 'Venta' : 'Compra'}</span>
                    </div>
                    <div class="history-detail">
                        <span class="detail-label">Aprobado el</span>
                        <span class="detail-value">${approvedDate}</span>
                    </div>
                </div>
                
                ${timerHTML}
                ${actionsHTML}
            `;
            
            return element;
        }
        
        function switchHistoryTab(tabName) {
            document.querySelectorAll('.history-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.history-content').forEach(content => {
                content.classList.remove('active');
            });
            
            const activeTab = document.querySelector(`.history-tab[onclick="switchHistoryTab('${tabName}')"]`);
            const activeContent = document.getElementById(`${tabName}-content`);
            
            if (activeTab) activeTab.classList.add('active');
            if (activeContent) activeContent.classList.add('active');
            
            switch (tabName) {
                case 'purchases':
                    renderPurchaseHistory();
                    break;
                case 'sales':
                    if (currentUser && currentUser.isAdmin) {
                        renderSalesHistory();
                    }
                    break;
                case 'active':
                    renderActiveVerifications();
                    break;
            }
        }
        
        function openHistoryModal() {
            if (!currentUser) {
                showNotification('Debes iniciar sesión para ver tu historial', 'error');
                openLoginModal();
                return;
            }
            
            const modal = document.getElementById('history-modal');
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                
                renderPurchaseHistory();
                if (currentUser.isAdmin) {
                    renderSalesHistory();
                }
                renderActiveVerifications();
            }
        }
        
        function closeHistoryModal() {
            const modal = document.getElementById('history-modal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }
        
        async function viewPurchasedContent(postId) {
            closeHistoryModal();
            
            const post = posts.find(p => p.id === postId);
            if (!post) {
                showNotification('La publicación no existe o fue eliminada', 'error');
                return;
            }
            
            const payment = purchaseHistory.find(p => p.postId === postId && p.status === 'approved');
            if (!payment && !currentUser.isAdmin) {
                showNotification('No tienes acceso a este contenido', 'error');
                return;
            }
            
            await openPostModal(postId);
        }
        
        async function loadUserData(firebaseUser) {
            try {
                const userDoc = await firebase.firestore().collection('users').doc(firebaseUser.uid).get();
                
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    currentUser = {
                        uid: firebaseUser.uid,
                        email: firebaseUser.email,
                        username: userData.username,
                        avatar: userData.avatar || userData.username.substring(0, 2).toUpperCase(),
                        isAdmin: userData.isAdmin || false,
                        isPremium: userData.isPremium || false,
                        nequi: userData.nequi || '',
                        binance: userData.binance || '',
                        joined: userData.joined || firebaseUser.metadata.creationTime
                    };
                } else {
                    const username = firebaseUser.email.split('@')[0];
                    const nequi = document.getElementById('register-nequi')?.value || '';
                    const binance = document.getElementById('register-binance')?.value || '';
                    
                    const newUser = {
                        email: firebaseUser.email,
                        username: username,
                        avatar: username.substring(0, 2).toUpperCase(),
                        isAdmin: true,
                        isPremium: false,
                        nequi: nequi,
                        binance: binance,
                        joined: new Date().toISOString()
                    };
                    
                    await firebase.firestore().collection('users').doc(firebaseUser.uid).set(newUser);
                    
                    currentUser = {
                        uid: firebaseUser.uid,
                        email: firebaseUser.email,
                        username: username,
                        avatar: username.substring(0, 2).toUpperCase(),
                        isAdmin: true,
                        isPremium: false,
                        nequi: nequi,
                        binance: binance,
                        joined: new Date().toISOString()
                    };
                }
                
                updateAuthUI();
                updateMobileUserInfo();
                await loadUsers();
                
            } catch (error) {
                console.error("Error cargando datos del usuario:", error);
                showNotification("Error al cargar datos del usuario", "error");
            }
        }
        
        async function loadUsers() {
            try {
                const usersSnapshot = await firebase.firestore().collection('users').get();
                users = [];
                usersSnapshot.forEach(doc => {
                    users.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                updateStats();
                updateMobileStats();
                
            } catch (error) {
                console.error("Error cargando usuarios:", error);
            }
        }
        
        async function loadPosts() {
            try {
                const loadingElement = document.getElementById('loading-posts');
                if (loadingElement) loadingElement.style.display = 'block';
                
                const postsSnapshot = await firebase.firestore().collection('posts')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                posts = [];
                postsSnapshot.forEach(doc => {
                    const data = doc.data();
                    posts.push({
                        id: doc.id,
                        ...data,
                        likes: data.likes || 0,
                        views: data.views || 0,
                        comments: data.comments || [],
                        likedBy: data.likedBy || []
                    });
                });
                
                if (loadingElement) loadingElement.style.display = 'none';
                renderPosts();
                updateStats();
                updateMobileStats();
                
            } catch (error) {
                console.error("Error cargando publicaciones:", error);
                const loadingElement = document.getElementById('loading-posts');
                if (loadingElement) loadingElement.style.display = 'none';
                showNotification("Error al cargar las publicaciones", "error");
            }
        }
        
        function generateCaptcha(type) {
            const characters = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let captcha = '';
            
            for (let i = 0; i < 6; i++) {
                captcha += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            
            if (type === 'register') {
                registerCaptcha = captcha;
                const captchaElement = document.getElementById('register-captcha-code');
                if (captchaElement) {
                    captchaElement.textContent = captcha;
                    captchaElement.style.color = '#FFFFFF';
                }
                const inputElement = document.getElementById('register-captcha-input');
                if (inputElement) {
                    inputElement.value = '';
                    inputElement.focus();
                }
            } else {
                loginCaptcha = captcha;
                const captchaElement = document.getElementById('login-captcha-code');
                if (captchaElement) {
                    captchaElement.textContent = captcha;
                    captchaElement.style.color = '#FFFFFF';
                }
                const inputElement = document.getElementById('login-captcha-input');
                if (inputElement) {
                    inputElement.value = '';
                    inputElement.focus();
                }
            }
        }
        
        function openRegisterModal() {
            closeAuthModal();
            const modal = document.getElementById('register-modal');
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                generateCaptcha('register');
                setTimeout(() => {
                    const usernameInput = document.getElementById('register-username');
                    if (usernameInput) usernameInput.focus();
                }, 100);
            }
        }
        
        function openLoginModal() {
            closeAuthModal();
            const modal = document.getElementById('login-modal');
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                generateCaptcha('login');
                setTimeout(() => {
                    const emailInput = document.getElementById('login-email');
                    if (emailInput) emailInput.focus();
                }, 100);
            }
        }
        
        function closeAuthModal() {
            document.querySelectorAll('.auth-modal').forEach(modal => {
                modal.classList.remove('active');
            });
            document.body.style.overflow = 'auto';
            
            document.querySelectorAll('.auth-error, .auth-success').forEach(el => {
                el.style.display = 'none';
                el.textContent = '';
            });
        }
        
        function switchToLogin() {
            closeAuthModal();
            setTimeout(() => openLoginModal(), 100);
        }
        
        function switchToRegister() {
            closeAuthModal();
            setTimeout(() => openRegisterModal(), 100);
        }
        
        async function registerUser() {
            const username = document.getElementById('register-username')?.value.trim();
            const email = document.getElementById('register-email')?.value.trim();
            const password = document.getElementById('register-password')?.value;
            const confirmPassword = document.getElementById('register-confirm')?.value;
            const nequi = document.getElementById('register-nequi')?.value.trim();
            const binance = document.getElementById('register-binance')?.value.trim();
            const captchaInput = document.getElementById('register-captcha-input')?.value.trim().toUpperCase();
            
            const errorEl = document.getElementById('register-error');
            const successEl = document.getElementById('register-success');
            const submitBtn = document.getElementById('register-submit');
            
            if (!username || !email || !password || !confirmPassword || !captchaInput) {
                showAuthError(errorEl, 'Todos los campos obligatorios son requeridos');
                return;
            }
            
            if (username.length < 3) {
                showAuthError(errorEl, 'El nombre de usuario debe tener al menos 3 caracteres');
                return;
            }
            
            if (!isValidEmail(email)) {
                showAuthError(errorEl, 'Ingresa un email válido');
                return;
            }
            
            if (password.length < 8) {
                showAuthError(errorEl, 'La contraseña debe tener al menos 8 caracteres');
                return;
            }
            
            if (password !== confirmPassword) {
                showAuthError(errorEl, 'Las contraseñas no coinciden');
                return;
            }
            
            if (captchaInput !== registerCaptcha) {
                showAuthError(errorEl, 'El código CAPTCHA es incorrecto');
                generateCaptcha('register');
                return;
            }
            
            try {
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creando cuenta...';
                }
                
                const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
                
                const userData = {
                    email: email,
                    username: username,
                    avatar: username.substring(0, 2).toUpperCase(),
                    isAdmin: true,
                    isPremium: false,
                    nequi: nequi || '',
                    binance: binance || '',
                    joined: new Date().toISOString()
                };
                
                await firebase.firestore().collection('users').doc(userCredential.user.uid).set(userData);
                
                if (errorEl) errorEl.style.display = 'none';
                if (successEl) {
                    successEl.textContent = '¡Cuenta creada exitosamente!';
                    successEl.style.display = 'block';
                }
                
                setTimeout(() => {
                    closeAuthModal();
                    showNotification('¡Bienvenido ' + username + '!', 'success');
                }, 1500);
                
            } catch (error) {
                console.error("Error registrando usuario:", error);
                
                let errorMessage = "Error al crear la cuenta";
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'El email ya está registrado';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'La contraseña es demasiado débil';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'El email no es válido';
                } else if (error.code === 'auth/operation-not-allowed') {
                    errorMessage = 'El registro no está habilitado';
                } else if (error.code === 'auth/network-request-failed') {
                    errorMessage = 'Error de red. Verifica tu conexión.';
                }
                
                showAuthError(errorEl, errorMessage);
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fas fa-user-plus"></i> Crear Cuenta';
                }
            }
        }
        
        async function loginUser() {
            const email = document.getElementById('login-email')?.value.trim();
            const password = document.getElementById('login-password')?.value;
            const captchaInput = document.getElementById('login-captcha-input')?.value.trim().toUpperCase();
            
            const errorEl = document.getElementById('login-error');
            const submitBtn = document.getElementById('login-submit');
            
            if (!email || !password || !captchaInput) {
                showAuthError(errorEl, 'Todos los campos son obligatorios');
                return;
            }
            
            if (captchaInput !== loginCaptcha) {
                showAuthError(errorEl, 'El código CAPTCHA es incorrecto');
                generateCaptcha('login');
                return;
            }
            
            try {
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Iniciando sesión...';
                }
                
                await firebase.auth().signInWithEmailAndPassword(email, password);
                
                closeAuthModal();
                showNotification('¡Sesión iniciada correctamente!', 'success');
                
            } catch (error) {
                console.error("Error iniciando sesión:", error);
                
                let errorMessage = "Error al iniciar sesión";
                if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                    errorMessage = 'Email o contraseña incorrectos';
                } else if (error.code === 'auth/user-disabled') {
                    errorMessage = 'La cuenta ha sido deshabilitada';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage = 'Demasiados intentos. Intenta más tarde';
                } else if (error.code === 'auth/network-request-failed') {
                    errorMessage = 'Error de red. Verifica tu conexión.';
                }
                
                showAuthError(errorEl, errorMessage);
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Iniciar Sesión';
                }
            }
        }
        
        async function logoutUser() {
            try {
                for (const timerId in verificationTimers) {
                    clearInterval(verificationTimers[timerId]);
                }
                verificationTimers = {};
                
                await firebase.auth().signOut();
                showNotification('Sesión cerrada exitosamente', 'info');
            } catch (error) {
                console.error("Error cerrando sesión:", error);
                showNotification('Error al cerrar sesión', 'error');
            }
        }
        
        function updateAuthUI() {
            const userInfo = document.getElementById('user-info');
            const createPostContainer = document.getElementById('create-post-container');
            const premiumOption = document.getElementById('premium-option');
            
            if (!userInfo) return;
            
            if (currentUser) {
                userInfo.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div class="user-avatar" onclick="showProfile()" title="${currentUser.username}">
                            ${currentUser.avatar}
                        </div>
                        <div style="display: flex; flex-direction: column;">
                            <div style="display: flex; align-items: center;">
                                <span style="font-weight: 600; color: #00b4d8;">${currentUser.username}</span>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 5px;">
                                <a href="#" onclick="logoutUser(); return false;" style="font-size: 12px; color: #90e0ef; text-decoration: none;">
                                    <i class="fas fa-sign-out-alt"></i> Cerrar sesión
                                </a>
                                <a href="#" onclick="openHistoryModal(); return false;" style="font-size: 12px; color: #2ecc71; text-decoration: none;">
                                    <i class="fas fa-history"></i> Historial
                                </a>
                            </div>
                        </div>
                    </div>
                `;
                
                if (createPostContainer) createPostContainer.style.display = 'flex';
                if (premiumOption) premiumOption.style.display = 'block';
            } else {
                userInfo.innerHTML = `
                    <div class="auth-buttons" id="auth-buttons">
                        <button class="auth-btn-header login-btn" onclick="openLoginModal()">
                            <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                        </button>
                        <button class="auth-btn-header register-btn" onclick="openRegisterModal()">
                            <i class="fas fa-user-plus"></i> Registrarse
                        </button>
                    </div>
                `;
                if (createPostContainer) createPostContainer.style.display = 'none';
                if (premiumOption) premiumOption.style.display = 'none';
                
                const form = document.getElementById('create-post-form');
                if (form && form.classList.contains('expanded')) {
                    toggleCreatePost();
                }
            }
            
            updateMobileUserInfo();
        }
        
        // FUNCIÓN CORREGIDA - SOLO muestra contenido premium si el pago fue APROBADO
        function hasAccessToPost(postId) {
            if (!currentUser) return false;
            
            const post = posts.find(p => p.id === postId);
            if (!post) return false;
            
            // Si NO es contenido premium, cualquier usuario logueado puede verlo
            if (post.category !== 'premium') return true;
            
            // IMPORTANTE: NO dar acceso a administradores automáticamente
            // Solo si han comprado el contenido específico
            
            // Verificar si el usuario compró este post específico y el pago fue APROBADO
            const purchase = purchaseHistory.find(p => 
                p.postId === postId && 
                p.userId === currentUser.uid && 
                p.status === 'approved'  // SOLO SI EL ESTADO ES 'approved'
            );
            
            // SOLO retorna true si compró y fue APROBADO
            return !!purchase;
        }
        
        function toggleCreatePost() {
            if (!currentUser) {
                showNotification('Debes iniciar sesión para crear publicaciones', 'error');
                openLoginModal();
                return;
            }
            
            const form = document.getElementById('create-post-form');
            const toggleBtn = document.querySelector('.create-post-toggle');
            
            if (!form || !toggleBtn) return;
            
            if (form.classList.contains('expanded')) {
                form.classList.remove('expanded');
                toggleBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Crear Nueva Publicación';
            } else {
                form.classList.add('expanded');
                toggleBtn.innerHTML = '<i class="fas fa-minus-circle"></i> Ocultar Formulario';
                
                setTimeout(() => {
                    const titleInput = document.getElementById('post-title');
                    if (titleInput) titleInput.focus();
                }, 300);
            }
        }
        
        function togglePriceField() {
            const category = document.getElementById('post-category').value;
            const priceFieldGroup = document.getElementById('price-field-group');
            const priceInput = document.getElementById('post-price');
            
            if (category === 'premium') {
                priceFieldGroup.style.display = 'flex';
                if (priceInput) {
                    priceInput.required = true;
                    priceInput.value = '';
                }
            } else {
                priceFieldGroup.style.display = 'none';
                if (priceInput) {
                    priceInput.required = false;
                    priceInput.value = '';
                }
            }
        }
        
        function previewImageBase64(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const maxSize = 5 * 1024 * 1024;
            if (file.size > maxSize) {
                showNotification('La imagen es demasiado grande. Máximo 5MB.', 'error');
                event.target.value = '';
                return;
            }
            
            const warningElement = document.getElementById('size-warning');
            const submitBtn = document.getElementById('submit-btn');
            
            if (submitBtn) {
                submitBtn.style.visibility = 'visible';
                submitBtn.style.opacity = '1';
                submitBtn.style.display = 'flex';
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Procesando imagen...';
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    let width = img.width;
                    let height = img.height;
                    const maxWidth = 800;
                    const maxHeight = 600;
                    
                    if (width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    }
                    
                    if (height > maxHeight) {
                        width = (width * maxHeight) / height;
                        height = maxHeight;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    const compressedBase64 = canvas.toDataURL('image/jpeg', 0.7);
                    
                    const sizeKB = Math.round(compressedBase64.length / 1024);
                    if (warningElement) {
                        warningElement.textContent = `Tamaño: ${sizeKB} KB (comprimido)`;
                        warningElement.style.display = 'block';
                        
                        if (sizeKB > 500) {
                            warningElement.style.color = '#ffd700';
                            warningElement.textContent += ' - Imagen grande, se recomienda usar una más pequeña';
                        } else {
                            warningElement.style.color = '#90e0ef';
                        }
                    }
                    
                    selectedImageBase64 = compressedBase64;
                    
                    const preview = document.getElementById('photo-preview');
                    if (preview) {
                        preview.src = compressedBase64;
                        preview.style.display = 'block';
                    }
                    
                    const uploadText = document.querySelector('#photo-upload-area p');
                    if (uploadText) {
                        uploadText.textContent = 'Imagen lista para subir';
                    }
                    
                    if (submitBtn) {
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Publicar';
                        submitBtn.style.visibility = 'visible';
                        submitBtn.style.opacity = '1';
                        submitBtn.style.display = 'flex';
                        submitBtn.offsetHeight;
                    }
                };
                
                img.onerror = function() {
                    showNotification('Error al cargar la imagen', 'error');
                    if (submitBtn) {
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Publicar';
                        submitBtn.style.visibility = 'visible';
                        submitBtn.style.opacity = '1';
                        submitBtn.style.display = 'flex';
                    }
                };
                
                img.src = e.target.result;
            };
            
            reader.onerror = function() {
                showNotification('Error al leer el archivo', 'error');
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Publicar';
                    submitBtn.style.visibility = 'visible';
                    submitBtn.style.opacity = '1';
                    submitBtn.style.display = 'flex';
                }
            };
            
            reader.readAsDataURL(file);
        }
        
        function getRandomPlaceholderImage(category) {
            const categoryColors = {
                metodos: '#00b4d8',
                bins: '#ff6b6b',
                cc: '#2ecc71',
                tools: '#f39c12',
                premium: '#ffd700',
                otros: '#9b59b6'
            };
            
            const color = categoryColors[category] || '#00b4d8';
            
            const svg = `
                <svg xmlns="http://www.w3.org/2000/svg" width="400" height="200" viewBox="0 0 400 200">
                    <rect width="400" height="200" fill="${color}" opacity="0.2"/>
                    <rect x="20" y="20" width="360" height="160" fill="none" stroke="${color}" stroke-width="2" stroke-dasharray="5,5"/>
                    <text x="200" y="110" text-anchor="middle" fill="${color}" font-family="Arial" font-size="24" font-weight="bold">
                        ${category.toUpperCase()}
                    </text>
                    <text x="200" y="140" text-anchor="middle" fill="${color}" font-family="Arial" font-size="14">
                        Sin imagen
                    </text>
                </svg>
            `;
            
            return 'data:image/svg+xml;base64,' + btoa(svg);
        }
        
        async function createPost() {
            if (!currentUser) {
                showNotification('Debes iniciar sesión para publicar', 'error');
                openLoginModal();
                return;
            }
            
            const title = document.getElementById('post-title')?.value.trim();
            const description = document.getElementById('post-description')?.value.trim();
            const category = document.getElementById('post-category')?.value;
            const price = document.getElementById('post-price')?.value;
            
            if (!title || !description) {
                showNotification('Completa el título y descripción', 'error');
                return;
            }
            
            if (category === 'premium') {
                if (!price || parseFloat(price) <= 0) {
                    showNotification('Ingresa un precio válido para la publicación premium', 'error');
                    return;
                }
            }
            
            const submitBtn = document.getElementById('submit-btn');
            const originalText = submitBtn ? submitBtn.innerHTML : '';
            if (submitBtn) {
                submitBtn.style.visibility = 'visible';
                submitBtn.style.opacity = '1';
                submitBtn.style.display = 'flex';
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Publicando...';
                submitBtn.disabled = true;
            }
            
            try {
                if (selectedImageBase64 && selectedImageBase64.length > 5 * 1024 * 1024) {
                    showNotification('La imagen es demasiado grande después de compresión (máximo 5MB). Intenta con una imagen más pequeña.', 'warning');
                    if (submitBtn) {
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                        submitBtn.style.visibility = 'visible';
                        submitBtn.style.opacity = '1';
                        submitBtn.style.display = 'flex';
                    }
                    return;
                }
                
                const postData = {
                    title: title,
                    description: description,
                    code: null,
                    imageBase64: selectedImageBase64 || null,
                    authorId: currentUser.uid,
                    authorName: currentUser.username,
                    authorAvatar: currentUser.avatar,
                    category: category,
                    price: category === 'premium' ? parseFloat(price) : null,
                    likes: 0,
                    likedBy: [],
                    comments: [],
                    views: 0,
                    isPremium: category === 'premium',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                await firebase.firestore().collection('posts').add(postData);
                
                clearForm();
                toggleCreatePost();
                
                await loadPosts();
                
                showNotification('¡Publicación creada exitosamente!', 'success');
                
                window.scrollTo({ top: 200, behavior: 'smooth' });
                
            } catch (error) {
                console.error("Error creando publicación:", error);
                showNotification('Error al crear la publicación', 'error');
            } finally {
                if (submitBtn) {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    submitBtn.style.visibility = 'visible';
                    submitBtn.style.opacity = '1';
                    submitBtn.style.display = 'flex';
                    submitBtn.offsetHeight;
                }
            }
        }
        
        function filterByCategory(category) {
            currentCategory = category;
            
            document.querySelectorAll('.category').forEach(cat => {
                cat.classList.remove('active');
            });
            
            document.querySelectorAll('.mobile-sidebar .category').forEach(cat => {
                cat.classList.remove('active');
            });
            
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            }
            
            renderPosts();
        }
        
        function updateStats() {
            const counts = {
                all: posts.length,
                metodos: posts.filter(post => post.category === 'metodos').length,
                bins: posts.filter(post => post.category === 'bins').length,
                cc: posts.filter(post => post.category === 'cc').length,
                tools: posts.filter(post => post.category === 'tools').length,
                premium: posts.filter(post => post.category === 'premium').length,
                otros: posts.filter(post => post.category === 'otros').length
            };
            
            for (const category in counts) {
                const element = document.getElementById(`count-${category}`);
                if (element) {
                    element.textContent = counts[category];
                }
            }
            
            const totalComments = posts.reduce((total, post) => total + (post.comments ? post.comments.length : 0), 0);
            const totalAdmins = users.filter(user => user.isAdmin).length;
            
            const totalPostsElement = document.getElementById('total-posts');
            const totalCommentsElement = document.getElementById('total-comments');
            const totalMembersElement = document.getElementById('total-members');
            
            if (totalPostsElement) totalPostsElement.textContent = posts.length;
            if (totalCommentsElement) totalCommentsElement.textContent = totalComments;
            if (totalMembersElement) totalMembersElement.textContent = users.length;
            
            const adminElements = document.querySelectorAll('.stat-item:nth-child(5) .stat-value');
            if (adminElements.length > 0) {
                adminElements[0].textContent = totalAdmins;
            }
        }
        
        function renderPosts() {
            const postsGrid = document.getElementById('posts-grid');
            if (!postsGrid) return;
            
            let filteredPosts = posts;
            if (currentCategory !== 'all') {
                filteredPosts = posts.filter(post => post.category === currentCategory);
            }
            
            postsGrid.innerHTML = '';
            
            if (filteredPosts.length === 0) {
                postsGrid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-inbox"></i>
                        </div>
                        <h3>No hay publicaciones en esta categoría</h3>
                        <p>Sé el primero en crear una publicación</p>
                    </div>
                `;
                return;
            }
            
            filteredPosts.forEach(post => {
                const postElement = createPostElement(post);
                postsGrid.appendChild(postElement);
            });
        }
        
        function createPostElement(post) {
            const postElement = document.createElement('div');
            postElement.className = 'post-card';
            
            const categoryIcons = {
                metodos: 'fas fa-code',
                bins: 'fas fa-credit-card',
                cc: 'fas fa-money-bill-wave',
                tools: 'fas fa-tools',
                premium: 'fas fa-crown',
                otros: 'fas fa-ellipsis-h'
            };
            
            const categoryNames = {
                metodos: 'Métodos',
                bins: 'Bins',
                cc: 'CC Gratis',
                tools: 'Herramientas',
                premium: 'Premium',
                otros: 'Otros'
            };
            
            const imageSrc = post.imageBase64 || getRandomPlaceholderImage(post.category);
            const imageHTML = `<img src="${imageSrc}" class="post-image" alt="${post.title}" loading="lazy">`;
            
            const userLiked = post.likedBy && currentUser ? post.likedBy.includes(currentUser.uid) : false;
            
            let commentsPreviewHTML = '';
            if (post.comments && post.comments.length > 0) {
                const lastComments = post.comments.slice(-2);
                commentsPreviewHTML = `
                    <div class="comments-preview">
                        ${lastComments.map(comment => `
                            <div class="comment-preview">
                                <div class="comment-avatar">${comment.authorAvatar || comment.authorName?.substring(0, 2).toUpperCase() || '??'}</div>
                                <div class="comment-content">
                                    <div class="comment-author">${comment.authorName || 'Usuario'}</div>
                                    <div class="comment-text">${(comment.text || '').substring(0, 60)}${(comment.text || '').length > 60 ? '...' : ''}</div>
                                </div>
                            </div>
                        `).join('')}
                        ${post.comments.length > 2 ? 
                            `<button class="view-comments-btn" onclick="openPostModal('${post.id}')">
                                <i class="fas fa-comments"></i>
                                Ver todos los comentarios (${post.comments.length})
                            </button>` : 
                            `<button class="view-comments-btn" onclick="openPostModal('${post.id}')">
                                <i class="fas fa-comment"></i>
                                Ver comentarios (${post.comments.length})
                            </button>`
                        }
                    </div>
                `;
            } else {
                commentsPreviewHTML = `
                    <div class="comments-preview">
                        <button class="view-comments-btn" onclick="openPostModal('${post.id}')">
                            <i class="fas fa-comment-medical"></i>
                            Sé el primero en comentar
                        </button>
                    </div>
                `;
            }
            
            const hasPurchasedThisPost = currentUser ? 
                purchaseHistory.some(p => 
                    p.postId === post.id && 
                    p.userId === currentUser.uid && 
                    p.status === 'approved'
                ) : false;
            
            const canViewPremium = hasAccessToPost(post.id);
            
            const premiumRestriction = !canViewPremium && post.category === 'premium' ? `
                <div class="premium-restricted">
                    <div class="premium-restricted-icon">
                        <i class="fas fa-crown"></i>
                    </div>
                    <h3>Contenido Premium</h3>
                    <p>Esta publicación es exclusiva para usuarios que hayan comprado este contenido específicamente.</p>
                    <p>Debes pagar $${post.price} USD y que el administrador apruebe tu pago para acceder.</p>
                    <button class="btn btn-premium" onclick="showPaymentInfo('${post.id}')" style="margin-top: 20px;">
                        <i class="fas fa-crown"></i> Comprar Acceso ($${post.price} USD)
                    </button>
                </div>
            ` : '';
            
            const postDate = formatDate(post.createdAt);
            
            const priceInfo = post.category === 'premium' && post.price ? 
                `<div style="margin: 10px 0; padding: 8px; background: rgba(255, 215, 0, 0.1); border-radius: 6px; border: 1px solid #ffd700; color: #ffd700; font-weight: bold; text-align: center;">
                    <i class="fas fa-dollar-sign"></i> Precio: $${post.price} USD
                    ${hasPurchasedThisPost ? '<span style="color: #2ecc71; margin-left: 10px;"><i class="fas fa-check"></i> COMPRADO Y APROBADO</span>' : ''}
                </div>` : '';
            
            const accessGrantedBadge = hasPurchasedThisPost ? '<div class="access-granted-badge"><i class="fas fa-check-circle"></i> ACCESO CONCEDIDO</div>' : '';
            
            postElement.innerHTML = `
                ${post.isPremium ? '<div class="premium-badge"><i class="fas fa-crown"></i> PREMIUM</div>' : ''}
                ${accessGrantedBadge}
                ${imageHTML}
                <div class="post-content">
                    <div class="post-header">
                        <div class="post-avatar">${post.authorAvatar || post.authorName?.substring(0, 2).toUpperCase() || '??'}</div>
                        <div class="post-info">
                            <div class="post-author">${post.authorName || 'Usuario'}</div>
                            <div class="post-meta">
                                <span class="post-category ${post.category === 'premium' ? 'post-category-premium' : ''}">
                                    <i class="${categoryIcons[post.category] || 'fas fa-ellipsis-h'}"></i> ${categoryNames[post.category] || 'Otros'}
                                </span>
                                <span>${postDate}</span>
                            </div>
                        </div>
                    </div>
                    
                    <h3 class="post-title">${post.title || 'Sin título'}</h3>
                    ${priceInfo}
                    <p class="post-description">${(post.description || '').substring(0, 100)}${(post.description || '').length > 100 ? '...' : ''}</p>
                    
                    <div class="post-stats">
                        <div class="post-actions">
                            <div class="post-action ${userLiked ? 'active' : ''}" onclick="${canViewPremium ? `likePost('${post.id}')` : 'showPremiumRestriction()'}">
                                <i class="${userLiked ? 'fas' : 'far'} fa-heart"></i>
                                <span>${post.likes || 0}</span>
                            </div>
                            <div class="post-action" onclick="${canViewPremium ? `openPostModal('${post.id}')` : 'showPremiumRestriction()'}">
                                <i class="far fa-comment"></i>
                                <span>${post.comments ? post.comments.length : 0}</span>
                            </div>
                            <div class="post-action">
                                <i class="far fa-eye"></i>
                                <span>${post.views || 0}</span>
                            </div>
                        </div>
                        <button class="view-btn" onclick="${canViewPremium ? `openPostModal('${post.id}')` : 'showPremiumRestriction()'}">
                            <i class="fas fa-expand-alt"></i> Ver completo
                        </button>
                    </div>
                    
                    ${canViewPremium ? commentsPreviewHTML : ''}
                </div>
                ${premiumRestriction}
            `;
            
            return postElement;
        }
        
        function showAuthError(element, message) {
            if (!element) return;
            
            element.textContent = message;
            element.style.display = 'block';
            
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }
        
        function isValidEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);
                
                if (diffMins < 60) {
                    return `Hace ${diffMins} minuto${diffMins !== 1 ? 's' : ''}`;
                } else if (diffHours < 24) {
                    return `Hace ${diffHours} hora${diffHours !== 1 ? 's' : ''}`;
                } else if (diffDays < 7) {
                    return `Hace ${diffDays} día${diffDays !== 1 ? 's' : ''}`;
                } else {
                    return date.toLocaleDateString('es-ES', { 
                        year: 'numeric', 
                        month: 'short', 
                        day: 'numeric' 
                    });
                }
            } catch (error) {
                return "Fecha desconocida";
            }
        }
        
        function showNotification(message, type = 'info', duration = 3000) {
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon = 'info-circle';
            if (type === 'error') icon = 'exclamation-circle';
            else if (type === 'success') icon = 'check-circle';
            else if (type === 'warning') icon = 'exclamation-triangle';
            
            notification.innerHTML = `
                <div style="display: flex; align-items: flex-start; gap: 10px;">
                    <i class="fas fa-${icon}"></i>
                    <div>${message}</div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, duration);
        }
        
        function clearForm() {
            const titleInput = document.getElementById('post-title');
            const descriptionInput = document.getElementById('post-description');
            const categoryInput = document.getElementById('post-category');
            const priceInput = document.getElementById('post-price');
            const photoInput = document.getElementById('photo-input');
            const photoPreview = document.getElementById('photo-preview');
            const uploadText = document.querySelector('#photo-upload-area p');
            const warningElement = document.getElementById('size-warning');
            const submitBtn = document.getElementById('submit-btn');
            
            if (titleInput) titleInput.value = '';
            if (descriptionInput) descriptionInput.value = '';
            if (categoryInput) categoryInput.value = 'metodos';
            if (priceInput) {
                priceInput.value = '';
                priceInput.required = false;
            }
            if (photoInput) photoInput.value = '';
            if (photoPreview) {
                photoPreview.style.display = 'none';
                photoPreview.src = '';
            }
            if (uploadText) uploadText.textContent = 'Haz clic para subir una imagen';
            if (warningElement) {
                warningElement.style.display = 'none';
                warningElement.textContent = '';
            }
            
            const priceFieldGroup = document.getElementById('price-field-group');
            if (priceFieldGroup) priceFieldGroup.style.display = 'none';
            
            if (submitBtn) {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Publicar';
                submitBtn.style.visibility = 'visible';
                submitBtn.style.opacity = '1';
                submitBtn.style.display = 'flex';
                submitBtn.offsetHeight;
            }
            
            selectedImageBase64 = null;
        }
        
        function clearComment() {
            const commentInput = document.getElementById('comment-input');
            if (commentInput) commentInput.value = '';
        }
        
        function showProfile() {
            if (!currentUser) return;
            
            const userPosts = posts.filter(p => p.authorId === currentUser.uid).length;
            const totalLikes = posts.filter(p => p.authorId === currentUser.uid).reduce((sum, p) => sum + (p.likes || 0), 0);
            const totalComments = posts.reduce((sum, p) => 
                sum + (p.comments ? p.comments.filter(c => c.authorId === currentUser.uid).length : 0), 0);
            
            const userType = currentUser.isAdmin ? 'Administrador' : 
                           currentUser.isPremium ? 'Usuario Premium' : 'Usuario';
            
            const profileInfo = `
                <strong>Usuario:</strong> ${currentUser.username}<br>
                <strong>Tipo:</strong> ${userType}<br>
                <strong>Email:</strong> ${currentUser.email}<br>
                <strong>Nequi:</strong> ${currentUser.nequi || 'No registrado'}<br>
                <strong>Binance:</strong> ${currentUser.binance || 'No registrado'}<br>
                <strong>Miembro desde:</strong> ${formatDate(currentUser.joined)}<br>
                <strong>Publicaciones:</strong> ${userPosts}<br>
                <strong>Likes recibidos:</strong> ${totalLikes}<br>
                <strong>Comentarios:</strong> ${totalComments}<br>
                <strong>Compras realizadas:</strong> ${purchaseHistory.length}
            `;
            
            showNotification(profileInfo, 'info', 5000);
        }
        
        function showPremiumRestriction() {
            showNotification('Acceso restringido. Solo usuarios que han comprado este contenido específico y su pago ha sido APROBADO por el administrador pueden verlo.', 'warning', 5000);
        }
        
        function contactAdmin() {
            showPaymentInfo(currentPostId);
        }
        
        async function likePost(postId) {
            if (!currentUser) {
                showNotification('Debes iniciar sesión para dar like', 'error');
                openLoginModal();
                return;
            }
            
            if (!hasAccessToPost(postId)) {
                showPremiumRestriction();
                return;
            }
            
            try {
                const postRef = firebase.firestore().collection('posts').doc(postId);
                const postDoc = await postRef.get();
                
                if (!postDoc.exists) return;
                
                const postData = postDoc.data();
                const likedBy = postData.likedBy || [];
                const isLiked = likedBy.includes(currentUser.uid);
                
                if (isLiked) {
                    await postRef.update({
                        likes: firebase.firestore.FieldValue.increment(-1),
                        likedBy: firebase.firestore.FieldValue.arrayRemove(currentUser.uid)
                    });
                } else {
                    await postRef.update({
                        likes: firebase.firestore.FieldValue.increment(1),
                        likedBy: firebase.firestore.FieldValue.arrayUnion(currentUser.uid)
                    });
                }
                
                await loadPosts();
                
                if (!isLiked) {
                    showNotification('Like agregado', 'success');
                }
                
            } catch (error) {
                console.error("Error dando like:", error);
                showNotification('Error al dar like', 'error');
            }
        }
        
        async function openPostModal(postId) {
            if (!currentUser) {
                showNotification('Debes iniciar sesión para ver publicaciones', 'error');
                openLoginModal();
                return;
            }
            
            // Validación estricta para contenido premium
            const post = posts.find(p => p.id === postId);
            if (post && post.category === 'premium') {
                if (!hasAccessToPost(postId)) {
                    showPremiumRestriction();
                    showPaymentInfo(postId);
                    return; // IMPORTANTE: Salir de la función si no tiene acceso
                }
            }
            
            currentPostId = postId;
            
            try {
                const postRef = firebase.firestore().collection('posts').doc(postId);
                const postDoc = await postRef.get();
                
                if (!postDoc.exists) {
                    showNotification('La publicación no existe', 'error');
                    return;
                }
                
                const post = { id: postDoc.id, ...postDoc.data() };
                
                await postRef.update({
                    views: firebase.firestore.FieldValue.increment(1)
                });
                
                const modalImage = document.getElementById('modal-image');
                if (modalImage) {
                    const imageSrc = post.imageBase64 || getRandomPlaceholderImage(post.category);
                    if (imageSrc) {
                        modalImage.src = imageSrc;
                        modalImage.style.display = 'block';
                    } else {
                        modalImage.style.display = 'none';
                    }
                }
                
                const categoryIcons = {
                    metodos: '<i class="fas fa-code"></i> Métodos',
                    bins: '<i class="fas fa-credit-card"></i> Bins',
                    cc: '<i class="fas fa-money-bill-wave"></i> CC Gratis',
                    tools: '<i class="fas fa-tools"></i> Herramientas',
                    premium: '<i class="fas fa-crown"></i> Premium',
                    otros: '<i class="fas fa-ellipsis-h"></i> Otros'
                };
                
                const modalAvatar = document.getElementById('modal-avatar');
                const modalAuthor = document.getElementById('modal-author');
                const modalCategory = document.getElementById('modal-category');
                const modalDate = document.getElementById('modal-date');
                
                if (modalAvatar) modalAvatar.textContent = post.authorAvatar || post.authorName?.substring(0, 2).toUpperCase() || '??';
                if (modalAuthor) modalAuthor.textContent = post.authorName || 'Usuario';
                if (modalCategory) modalCategory.innerHTML = categoryIcons[post.category] || categoryIcons.otros;
                if (modalDate) modalDate.textContent = formatDate(post.createdAt);
                
                const modalTitle = document.getElementById('modal-title');
                const modalDescription = document.getElementById('modal-description');
                if (modalTitle) modalTitle.textContent = post.title || 'Sin título';
                if (modalDescription) modalDescription.textContent = post.description || '';
                
                const modalCode = document.getElementById('modal-code');
                if (modalCode) {
                    modalCode.style.display = 'none';
                }
                
                const userLiked = post.likedBy && post.likedBy.includes(currentUser.uid);
                
                const modalLikes = document.getElementById('modal-likes');
                const modalViews = document.getElementById('modal-views');
                const modalCommentsCount = document.getElementById('modal-comments-count');
                
                if (modalLikes) modalLikes.textContent = post.likes || 0;
                if (modalViews) modalViews.textContent = (post.views || 0) + 1;
                if (modalCommentsCount) modalCommentsCount.textContent = post.comments ? post.comments.length : 0;
                
                const likeBtn = document.getElementById('modal-like-btn');
                const likeIcon = document.getElementById('modal-like-icon');
                if (likeBtn) likeBtn.className = `post-action ${userLiked ? 'active' : ''}`;
                if (likeIcon) likeIcon.className = userLiked ? 'fas fa-heart' : 'far fa-heart';
                
                const commentsCount = document.getElementById('comments-count');
                if (commentsCount) commentsCount.textContent = `Comentarios (${post.comments ? post.comments.length : 0})`;
                
                renderComments(post.comments || []);
                
                // Mostrar información de pago del vendedor si es una compra premium
                const sellerPaymentDetails = document.getElementById('seller-payment-details');
                const sellerNequi = document.getElementById('seller-nequi');
                const sellerBinance = document.getElementById('seller-binance');
                
                if (post.category === 'premium' && currentUser) {
                    const purchase = purchaseHistory.find(p => 
                        p.postId === postId && 
                        p.userId === currentUser.uid && 
                        p.status === 'approved'
                    );
                    
                    if (purchase) {
                        // Obtener información del vendedor
                        const authorDoc = await firebase.firestore().collection('users').doc(post.authorId).get();
                        if (authorDoc.exists) {
                            const authorData = authorDoc.data();
                            
                            if (sellerPaymentDetails) sellerPaymentDetails.style.display = 'block';
                            if (sellerNequi) sellerNequi.textContent = authorData.nequi || 'No disponible';
                            if (sellerBinance) sellerBinance.textContent = authorData.binance || 'No disponible';
                        }
                    }
                }
                
                const purchaseHistorySection = document.getElementById('purchase-history-section');
                if (purchaseHistorySection) {
                    const payment = purchaseHistory.find(p => 
                        p.postId === postId && 
                        p.userId === currentUser.uid && 
                        p.status === 'approved'
                    );
                    
                    if (payment) {
                        purchaseHistorySection.style.display = 'block';
                        
                        const timeLeft = calculateTimeLeft(payment.approvedAt);
                        const hours = Math.floor(timeLeft / (1000 * 60 * 60));
                        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                        const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                        
                        const timerDisplay = document.getElementById('timer-display');
                        if (timerDisplay) {
                            timerDisplay.textContent = timeString;
                            
                            if (timeLeft < 30 * 60 * 1000) {
                                timerDisplay.classList.add('timer-expired');
                            }
                        }
                    } else {
                        purchaseHistorySection.style.display = 'none';
                    }
                }
                
                const commentInput = document.getElementById('comment-input');
                if (commentInput) commentInput.value = '';
                
                const postModal = document.getElementById('post-modal');
                if (postModal) {
                    postModal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
                
                setTimeout(() => {
                    const commentInput = document.getElementById('comment-input');
                    if (commentInput) commentInput.focus();
                }, 300);
                
            } catch (error) {
                console.error("Error abriendo publicación:", error);
                showNotification('Error al cargar la publicación', 'error');
            }
        }
        
        function renderComments(comments) {
            const commentsList = document.getElementById('comments-list');
            if (!commentsList) return;
            
            commentsList.innerHTML = '';
            
            if (!comments || comments.length === 0) {
                commentsList.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #666;">
                        <i class="fas fa-comment-slash" style="font-size: 48px; margin-bottom: 15px;"></i>
                        <p>No hay comentarios aún. ¡Sé el primero en comentar!</p>
                    </div>
                `;
                return;
            }
            
            const sortedComments = [...comments].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            sortedComments.forEach(comment => {
                const commentElement = document.createElement('div');
                commentElement.className = 'comment';
                commentElement.innerHTML = `
                    <div class="comment-avatar-modal">${comment.authorAvatar || comment.authorName?.substring(0, 2).toUpperCase() || '??'}</div>
                    <div class="comment-body">
                        <div class="comment-header">
                            <div class="comment-author-modal">${comment.authorName || 'Usuario'}</div>
                            <div class="comment-time">${formatDate(comment.createdAt)}</div>
                        </div>
                        <div class="comment-text-modal">${comment.text || ''}</div>
                    </div>
                `;
                
                commentsList.appendChild(commentElement);
            });
        }
        
        async function addComment() {
            if (!currentUser) {
                showNotification('Debes iniciar sesión para comentar', 'error');
                closeModal();
                openLoginModal();
                return;
            }
            
            if (!currentPostId) return;
            
            const commentInput = document.getElementById('comment-input');
            const commentText = commentInput?.value.trim();
            
            if (!commentText) {
                showNotification('Escribe un comentario primero', 'error');
                return;
            }
            
            if (!hasAccessToPost(currentPostId)) {
                showPremiumRestriction();
                return;
            }
            
            try {
                const postRef = firebase.firestore().collection('posts').doc(currentPostId);
                
                const newComment = {
                    authorId: currentUser.uid,
                    authorName: currentUser.username,
                    authorAvatar: currentUser.avatar,
                    text: commentText,
                    createdAt: new Date().toISOString()
                };
                
                await postRef.update({
                    comments: firebase.firestore.FieldValue.arrayUnion(newComment),
                    updatedAt: new Date().toISOString()
                });
                
                const updatedPostDoc = await postRef.get();
                const updatedPostData = updatedPostDoc.data();
                renderComments(updatedPostData.comments || []);
                
                const commentsCount = updatedPostData.comments ? updatedPostData.comments.length : 0;
                const commentsCountElement = document.getElementById('comments-count');
                const modalCommentsCount = document.getElementById('modal-comments-count');
                
                if (commentsCountElement) commentsCountElement.textContent = `Comentarios (${commentsCount})`;
                if (modalCommentsCount) modalCommentsCount.textContent = commentsCount;
                
                if (commentInput) commentInput.value = '';
                
                showNotification('Comentario publicado', 'success');
                
                await loadPosts();
                
                if (commentInput) commentInput.focus();
                
            } catch (error) {
                console.error("Error agregando comentario:", error);
                showNotification('Error al publicar el comentario', 'error');
            }
        }
        
        async function likePostModal() {
            if (!currentUser || !currentPostId) return;
            
            if (!hasAccessToPost(currentPostId)) {
                showPremiumRestriction();
                return;
            }
            
            try {
                await likePost(currentPostId);
                
                const postRef = firebase.firestore().collection('posts').doc(currentPostId);
                const postDoc = await postRef.get();
                
                if (postDoc.exists) {
                    const postData = postDoc.data();
                    const userLiked = postData.likedBy && postData.likedBy.includes(currentUser.uid);
                    
                    const likeBtn = document.getElementById('modal-like-btn');
                    const likeIcon = document.getElementById('modal-like-icon');
                    const modalLikes = document.getElementById('modal-likes');
                    
                    if (likeBtn) likeBtn.className = `post-action ${userLiked ? 'active' : ''}`;
                    if (likeIcon) likeIcon.className = userLiked ? 'fas fa-heart' : 'far fa-heart';
                    if (modalLikes) modalLikes.textContent = postData.likes || 0;
                }
                
            } catch (error) {
                console.error("Error dando like desde modal:", error);
            }
        }
        
        function closeModal() {
            const postModal = document.getElementById('post-modal');
            if (postModal) {
                postModal.classList.remove('active');
                document.body.style.overflow = 'auto';
                currentPostId = null;
            }
        }
        
        const postModal = document.getElementById('post-modal');
        if (postModal) {
            postModal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
        }
        
        function previewReceiptBase64(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const maxSize = MAX_RECEIPT_SIZE;
            if (file.size > maxSize) {
                showNotification('El comprobante es demasiado grande. Máximo 5MB.', 'error');
                event.target.value = '';
                return;
            }
            
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp', 'application/pdf'];
            if (!allowedTypes.includes(file.type)) {
                showNotification('Formato no permitido. Usa JPG, PNG, PDF o WEBP.', 'error');
                event.target.value = '';
                return;
            }
            
            selectedReceiptFile = file;
            
            const submitBtn = document.getElementById('submit-receipt-btn');
            if (submitBtn) {
                submitBtn.disabled = false;
            }
            
            const sizeInfo = document.getElementById('receipt-size-info');
            if (sizeInfo) {
                const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
                sizeInfo.textContent = `Tamaño: ${sizeMB} MB`;
                
                if (file.size > 4 * 1024 * 1024) {
                    sizeInfo.className = 'file-size-info file-size-warning';
                    sizeInfo.textContent += ' (Cerca del límite)';
                } else {
                    sizeInfo.className = 'file-size-info';
                }
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                selectedReceiptBase64 = e.target.result;
                
                const base64Size = selectedReceiptBase64.length;
                if (base64Size > maxSize) {
                    showNotification('El archivo es demasiado grande después de la conversión a Base64. Intenta con un archivo más pequeño.', 'error');
                    clearReceipt();
                    return;
                }
                
                if (file.type.startsWith('image/')) {
                    const preview = document.getElementById('receipt-preview');
                    if (preview) {
                        preview.src = selectedReceiptBase64;
                        preview.style.display = 'block';
                    }
                    
                    const uploadText = document.querySelector('#receipt-upload-area p');
                    if (uploadText) {
                        uploadText.textContent = 'Comprobante listo para enviar';
                    }
                } else {
                    const uploadText = document.querySelector('#receipt-upload-area p');
                    if (uploadText) {
                        uploadText.textContent = `PDF listo: ${file.name}`;
                    }
                }
                
                if (sizeInfo) {
                    const base64MB = (base64Size / (1024 * 1024)).toFixed(2);
                    sizeInfo.textContent += ` | Base64: ${base64MB} MB`;
                }
            };
            
            reader.onerror = function() {
                showNotification('Error al leer el archivo', 'error');
                clearReceipt();
            };
            
            reader.readAsDataURL(file);
        }
        
        function clearReceipt() {
            selectedReceiptFile = null;
            selectedReceiptBase64 = null;
            
            const preview = document.getElementById('receipt-preview');
            if (preview) {
                preview.style.display = 'none';
                preview.src = '';
            }
            
            const input = document.getElementById('receipt-input');
            if (input) input.value = '';
            
            const uploadText = document.querySelector('#receipt-upload-area p');
            if (uploadText) {
                uploadText.textContent = 'Haz clic para subir tu comprobante';
            }
            
            const sizeInfo = document.getElementById('receipt-size-info');
            if (sizeInfo) {
                sizeInfo.textContent = '';
                sizeInfo.className = 'file-size-info';
            }
            
            const submitBtn = document.getElementById('submit-receipt-btn');
            if (submitBtn) submitBtn.disabled = true;
            
            const errorEl = document.getElementById('receipt-error');
            if (errorEl) {
                errorEl.style.display = 'none';
                errorEl.textContent = '';
            }
        }
        
        async function submitPaymentReceiptBase64() {
            if (!currentUser) {
                showNotification('Debes iniciar sesión', 'error');
                openLoginModal();
                return;
            }
            
            if (!selectedReceiptFile || !currentPaymentPost || !selectedReceiptBase64) {
                showNotification('Primero sube tu comprobante', 'error');
                return;
            }
            
            const base64Size = selectedReceiptBase64.length;
            if (base64Size > MAX_RECEIPT_SIZE) {
                showNotification('El comprobante es demasiado grande. Máximo 5MB en Base64.', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('submit-receipt-btn');
            const errorEl = document.getElementById('receipt-error');
            
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';
            }
            
            try {
                const paymentId = 'payment_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                
                const paymentData = {
                    paymentId: paymentId,
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    username: currentUser.username,
                    postId: currentPaymentPost.id,
                    postTitle: currentPaymentPost.title,
                    postPrice: currentPaymentPost.price,
                    binanceAddress: BINANCE_ADDRESS,
                    receiptFileName: selectedReceiptFile.name,
                    receiptFileType: selectedReceiptFile.type,
                    receiptFileSize: selectedReceiptFile.size,
                    receiptBase64: selectedReceiptBase64,
                    receiptBase64Size: base64Size,
                    receiptUrl: selectedReceiptBase64,
                    status: 'pending',
                    verificationStatus: 'pending',
                    adminNotes: '',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                await firebase.firestore().collection('payments').doc(paymentId).set(paymentData);
                
                clearReceipt();
                
                closePaymentModal();
                
                showConfirmationModal();
                
                notifyAdminsAboutPayment(paymentData);
                
                await loadPurchaseHistory();
                
                showNotification('Comprobante enviado exitosamente', 'success');
                
            } catch (error) {
                console.error("Error enviando comprobante:", error);
                if (errorEl) {
                    errorEl.textContent = 'Error al enviar el comprobante. Intenta de nuevo.';
                    errorEl.style.display = 'block';
                }
                showNotification('Error al enviar el comprobante', 'error');
            } finally {
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Enviar Comprobante';
                }
            }
        }
        
        async function notifyAdminsAboutPayment(paymentData) {
            try {
                const adminsSnapshot = await firebase.firestore().collection('users')
                    .where('isAdmin', '==', true)
                    .get();
                
                adminsSnapshot.forEach(async (doc) => {
                    const adminData = doc.data();
                    
                    const notificationData = {
                        type: 'new_payment',
                        title: 'Nuevo pago pendiente',
                        message: `${paymentData.username} ha enviado un comprobante por $${paymentData.postPrice} USD para "${paymentData.postTitle}"`,
                        paymentId: paymentData.paymentId,
                        userId: adminData.uid || doc.id,
                        read: false,
                        createdAt: new Date().toISOString()
                    };
                    
                    await firebase.firestore().collection('notifications').add(notificationData);
                });
                
                console.log('Administradores notificados');
            } catch (error) {
                console.error("Error notificando administradores:", error);
            }
        }
        
        function showConfirmationModal() {
            const modal = document.getElementById('confirmation-modal');
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }
        
        function closeConfirmationModal() {
            const modal = document.getElementById('confirmation-modal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }
        
        async function showPaymentInfo(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            
            currentPaymentPost = post;
            
            document.getElementById('payment-post-title').textContent = post.title || 'Título no disponible';
            document.getElementById('payment-price').textContent = post.price ? `$${post.price} USD` : '$0 USD';
            document.getElementById('binance-address').textContent = BINANCE_ADDRESS;
            
            // Obtener información de pago del vendedor
            try {
                const authorDoc = await firebase.firestore().collection('users').doc(post.authorId).get();
                if (authorDoc.exists) {
                    const authorData = authorDoc.data();
                    const userPaymentInfo = document.getElementById('user-payment-info');
                    const sellerNequiInfo = document.getElementById('seller-nequi-info');
                    const sellerBinanceInfo = document.getElementById('seller-binance-info');
                    
                    if (userPaymentInfo) userPaymentInfo.style.display = 'block';
                    if (sellerNequiInfo) sellerNequiInfo.textContent = authorData.nequi || 'No disponible';
                    if (sellerBinanceInfo) sellerBinanceInfo.textContent = authorData.binance || 'No disponible';
                }
            } catch (error) {
                console.error("Error obteniendo información del vendedor:", error);
            }
            
            clearReceipt();
            
            const paymentModal = document.getElementById('payment-modal');
            if (paymentModal) {
                paymentModal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }
        
        function closePaymentModal() {
            const paymentModal = document.getElementById('payment-modal');
            if (paymentModal) {
                paymentModal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }
        
        function ensureButtonVisibility() {
            const submitBtn = document.getElementById('submit-btn');
            if (submitBtn) {
                submitBtn.style.visibility = 'visible';
                submitBtn.style.opacity = '1';
                submitBtn.style.display = 'flex';
                submitBtn.disabled = false;
            }
        }
        
        setInterval(ensureButtonVisibility, 1000);
        
        // Cerrar menú móvil al hacer clic en enlaces
        document.querySelectorAll('.mobile-sidebar a, .mobile-sidebar button').forEach(element => {
            element.addEventListener('click', () => {
                closeMobileMenu();
            });
        });
    </script>
</body>
</html>
